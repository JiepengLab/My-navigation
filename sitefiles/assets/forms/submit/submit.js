$apiUrl=utils.getQueryString("apiUrl")||$formConfigApiUrl,$rootUrl="/",$token=localStorage.getItem(ACCESS_TOKEN_NAME);var $api=axios.create({baseURL:$apiUrl,headers:{Authorization:"Bearer "+$token}}),$url="/v1/forms",$urlStyles="/v1/forms/styles",$urlSendSms="/v1/forms/actions/sendSms",$urlUpload="/v1/forms/actions/upload",data=utils.init({siteId:utils.getQueryInt("siteId")||$formConfigSiteId,channelId:utils.getQueryInt("channelId")||$formConfigChannelId,contentId:utils.getQueryInt("contentId")||$formConfigContentId,formId:utils.getQueryInt("formId")||$formConfigFormId,pageType:"",siteUrl:null,styles:[],title:"",description:"",successMessage:"",successCallback:"",isSms:!1,smsCountdown:0,isCaptcha:!1,captcha:"",captchaValue:"",captchaUrl:null,uploadUrl:null,form:null,uploadImageUrl:null,uploadImageList:[]}),methods={runFormLayerImageUploadText:function(t,s,i){this.insertText(t,s,i)},insertText:function(t,s,i){(this.form[utils.getCountName(t)]||0)<=s&&(this.form[utils.getCountName(t)]=s),this.form[utils.getExtendName(t,s)]=i,this.form=_.assign({},this.form)},apiGet:function(){var t=this;utils.loading(this,!0),$api.get($urlStyles,{params:{siteId:this.siteId,formId:this.formId}}).then(function(s){var i=s.data;t.title=i.title,t.description=i.description,t.successMessage=i.successMessage,t.successCallback=i.successCallback,t.isSms=i.isSms,t.isCaptcha=i.isCaptcha,t.isCaptcha&&t.apiCaptchaLoad(),t.siteUrl=i.siteUrl,t.styles=i.styles,t.form=utils.getForm(i.styles,_.assign({},i.formData,{captcha:"",smsMobile:"",smsCode:""})),t.pageType="form",t.uploadUrl=$apiUrl+$urlUpload+"?siteId="+t.siteId+"&formId="+t.formId}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},apiSendSms:function(){var t=this;utils.loading(this,!0);var s=$urlSendSms+"?siteId="+this.siteId+"&formId="+this.formId;$api.post(s,{mobile:this.form.smsMobile}).then(function(s){s.data;utils.notifySuccess("验证码发送成功，10分钟内有效"),t.smsCountdown=60;var i=setInterval(function(){t.smsCountdown-=1,t.smsCountdown<=0&&clearInterval(i)},1e3)}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},apiCaptchaLoad:function(){var t=this;utils.loading(this,!0),$api.post("/v1/captcha").then(function(s){var i=s.data;t.captchaValue=i.value,t.captchaUrl=$apiUrl+"/v1/captcha/"+i.value}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},apiCaptchaCheck:function(){var t=this;$api.post("/v1/captcha/actions/check",{captcha:this.form.captcha,value:this.captchaValue}).then(function(s){t.apiSubmit()}).catch(function(t){utils.error(t)})},apiSubmit:function(){var $this=this;utils.loading(!0);var urlPost=$url+"?siteId="+this.siteId+"&channelId="+this.channelId+"&contentId="+this.contentId+"&formId="+this.formId;$api.post(urlPost,_.assign({},this.form)).then(function(response){var res=response.data;if($this.pageType="success",$this.successCallback){var callback=$this.successCallback;-1===callback.indexOf("parent.")&&(callback="parent."+callback),-1===callback.indexOf("(")&&(callback+="()"),eval(callback)}}).catch(function(t){utils.error(t)}).then(function(){utils.loading($this,!1)})},getUploadUrl:function(t){return this.uploadUrl+"&attributeName="+t.attributeName},isMobile:function(t){return/^1[3-9]\d{9}$/.test(t)},btnSendSmsClick:function(){this.smsCountdown>0||(this.form.smsMobile?this.isMobile(this.form.smsMobile)?this.apiSendSms():utils.error("请输入有效的手机号码"):utils.error("手机号码不能为空"))},btnSubmitClick:function(){var t=this;this.$refs.form.validate(function(s){s&&(t.isCaptcha?t.apiCaptchaCheck():t.apiSubmit())})},uploadImageBefore:t=>/(\.jpg|\.jpeg|\.bmp|\.gif|\.png|\.webp)$/i.exec(t.name)?!!(t.size/1024/1024<10)||(utils.error("图片大小不能超过 10MB!"),!1):(utils.error("图片格式不正确，请选择有效的文件上传!"),!1),uploadProgress:function(){utils.loading(this,!0)},uploadSuccess:function(t,s,i){var a=utils.toCamelCase(t.attributeName);this.form[a]=t.virtualUrl,utils.loading(this,!1),i.length>1&&i.splice(0,1)},uploadError:function(t){utils.loading(this,!1);var s=JSON.parse(t.message);utils.error(s.message)},uploadRemove(t,s){var i=t.response,a=utils.toCamelCase(i.attributeName);this.form[a]=""}},$vue=new Vue({el:"#main",data:data,methods:methods,created:function(){this.apiGet()}});