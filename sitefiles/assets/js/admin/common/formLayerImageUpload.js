var $url="/common/form/layerImageUpload",data=utils.init({inputType:utils.getQueryString("inputType")||"Image",attributeName:utils.getQueryString("attributeName"),no:utils.getQueryInt("no"),editorAttributeName:utils.getQueryString("editorAttributeName"),uploadUrl:null,dialogImageUrl:"",dialogVisible:!1,fileNames:[],files:[],form:{userId:utils.getQueryInt("userId"),siteId:utils.getQueryInt("siteId"),isEditor:!1,isMaterial:!0,isThumb:!1,thumbWidth:500,thumbHeight:500,isLinkToOriginal:!0,filePaths:[]}}),methods={parentInsert:function(i,t){if("Image"===this.inputType){var e=parent.$vue;if(e.runFormLayerImageUploadText&&e.runFormLayerImageUploadText(this.attributeName,i,t.imageVirtualUrl),e.runFormLayerImageUploadEditor&&this.editorAttributeName&&this.form.isEditor){var r='<img src="'+t.imageUrl+'" style="border: 0; max-width: 100%" />';if(t.previewUrl){var a="'"+t.previewUrl+"'",s='<el-image src="'+t.imageUrl+'" :preview-src-list="['+a+']" style="border: 0; max-width: 100%"></el-image>';r='<img data-vue="'+encodeURIComponent(s)+'" src="'+t.imageUrl+'" style="border: 0; max-width: 100%" />'}e.runFormLayerImageUploadEditor(this.editorAttributeName,r)}}else if("TextEditor"===this.inputType&&parent.$vue.runEditorLayerImage){r='<img src="'+t.imageUrl+'" style="border: 0; max-width: 100%" />';if(t.previewUrl){a="'"+t.previewUrl+"'",s='<el-image src="'+t.imageUrl+'" :preview-src-list="['+a+']" style="border: 0; max-width: 100%"></el-image>';r='<img data-vue="'+encodeURIComponent(s)+'" src="'+t.imageUrl+'" style="border: 0; max-width: 100%" />'}parent.$vue.runEditorLayerImage(this.attributeName,r)}},apiGet:function(){var i=this;utils.loading(this,!0),$api.get($url,{params:{userId:this.form.userId,siteId:this.form.siteId}}).then(function(t){var e=t.data;i.form.isEditor=e.isEditor,i.form.isMaterial=e.isMaterial,i.form.isThumb=e.isThumb,i.form.thumbWidth=e.thumbWidth,i.form.thumbHeight=e.thumbHeight,i.form.isLinkToOriginal=e.isLinkToOriginal}).catch(function(i){utils.error(i)}).then(function(){utils.loading(i,!1)})},apiSubmit:function(){var i=this;utils.loading(this,!0),this.form.filePaths=[];for(var t=0;t<this.fileNames.length;t++)for(var e=this.fileNames[t],r=0;r<this.files.length;r++){var a=this.files[r];a.name!==e||this.form.filePaths.push(a.path)}$api.post($url,this.form).then(function(t){var e=t.data;if(e&&e.length>0)for(var r=0;r<e.length;r++){var a=e[r];i.parentInsert(i.no+r,a)}utils.closeLayer()}).catch(function(i){utils.error(i)}).then(function(){utils.loading(i,!1)})},btnSubmitClick:function(){if(0===this.files.length)return utils.error("请选择需要插入的图片文件！"),!1;this.apiSubmit()},btnCancelClick:function(){utils.closeLayer()},uploadBefore(i){return this.fileNames.push(i.name),!0},uploadProgress:function(){utils.loading(this,!0)},uploadSuccess:function(i){this.files.push(i),utils.loading(this,!1)},uploadError:function(i){utils.loading(this,!1);var t=JSON.parse(i.message);utils.error(t.message)},uploadRemove(i){if(i.response){for(var t=0,e=0;e<this.files.length;e++){if(this.files[e].path===i.path){t=e;break}}this.files.splice(t,1)}},uploadPictureCardPreview(i){this.dialogImageUrl=i.url,this.dialogVisible=!0}},$vue=new Vue({el:"#main",data:data,methods:methods,created:function(){utils.keyPress(this.btnSubmitClick,this.btnCancelClick),this.uploadUrl=$apiUrl+$url+"/actions/upload?siteId="+this.form.siteId+"&userId="+this.form.userId,this.apiGet()}});