var $url="/cms/contents/contentsRecycle",$urlDelete=$url+"/actions/delete",$defaultWidth=160,data=utils.init({siteId:utils.getQueryInt("siteId"),root:null,siteUrl:null,groupNames:null,tagNames:null,checkedLevels:[],pageContents:null,total:null,pageSize:null,page:1,columns:null,titleColumn:null,bodyColumn:null,multipleSelection:[],checkedColumns:[],searchColumns:[],channelIds:[],searchForm:{startDate:null,endDate:null,checkedLevels:[],isTop:!1,isRecommend:!1,isHot:!1,isColor:!1,groupNames:[],tagNames:[]},isRestoreForm:!1,restoreTitle:null,restoreForm:{}}),methods={apiTree:function(){var e=this;$api.post($url+"/actions/tree",{siteId:this.siteId}).then(function(t){var n=t.data;e.root=n.root,e.siteUrl=n.siteUrl,e.groupNames=n.groupNames,e.tagNames=n.tagNames,e.checkedLevels=n.checkedLevels,e.columns=n.columns,e.titleColumn=n.titleColumn,e.bodyColumn=n.bodyColumn,e.searchColumns.push({attributeName:e.titleColumn.attributeName,displayName:e.titleColumn.displayName,value:""}),e.searchColumns.push({attributeName:e.bodyColumn.attributeName,displayName:e.bodyColumn.displayName,value:""}),e.searchForm.checkedLevels=_.map(n.checkedLevels,function(e){return e.label}),e.apiList(e.siteId,1)}).catch(function(t){utils.loading(e,!1),utils.error(t)})},apiList:function(e,t,n){for(var i=this,l=[],s=0;s<this.searchColumns.length;s++){var a=this.searchColumns[s];a.attributeName&&a.value&&l.push({key:a.attributeName,value:a.value})}var o=this.channelIds&&this.channelIds.length>0?this.channelIds[this.channelIds.length-1]:null;utils.loading(this,!0);var r=_.assign({siteId:this.siteId,isCheckedLevels:this.isCheckedLevels,channelId:o,page:t,items:l},this.searchForm);$api.post($url+"/actions/list",r).then(function(e){var l=e.data;i.pageContents=l.pageContents,i.total=l.total,i.pageSize=l.pageSize,i.page=t,n&&utils.success(n)}).catch(function(e){utils.error(e)}).then(function(){utils.loading(i,!1),i.scrollToTop()})},apiColumns:function(e){$api.post($url+"/actions/columns",{siteId:this.siteId,attributeNames:e}).then(function(e){e.data}).catch(function(e){utils.error(e)})},apiDelete:function(e,t){var n=this;utils.loading(this,!0),$api.post($urlDelete,e).then(function(e){e.data;n.apiList(n.siteId,1,t)}).catch(function(e){utils.loading(n,!1),utils.error(e)})},btnDeleteAllClick:function(){var e=this;utils.alertDelete({title:"删除全部内容",text:"确实要永久性地删除全部内容吗？",callback:function(){e.apiDelete({siteId:e.siteId,action:"DeleteAll",channelContentIds:"",restoreChannelId:0},"成功删除全部内容！")}})},btnDeleteSelectClick:function(){var e=this;utils.alertDelete({title:"删除选中内容",text:"确实要永久性地删除选中内容吗？",callback:function(){e.apiDelete({siteId:e.siteId,action:"Delete",channelContentIds:e.channelContentIdsString,restoreChannelId:0},"成功删除选中内容！")}})},btnDeleteClick:function(e){var t=this;utils.alertDelete({title:"删除内容",text:"确实要永久性地删除此内容吗？",callback:function(){t.apiDelete({siteId:t.siteId,action:"Delete",channelContentIds:e.channelId+"_"+e.id,restoreChannelId:0},"成功删除内容！")}})},btnRestoreAllClick:function(){this.restoreTitle="还原全部内容",this.restoreForm={action:"RestoreAll",channelContentIds:"",restoreChannelIds:null},this.isRestoreForm=!0},btnRestoreSelectClick:function(){this.restoreTitle="还原选中内容",this.restoreForm={action:"Restore",channelContentIds:this.channelContentIdsString,restoreChannelIds:null},this.isRestoreForm=!0},btnRestoreClick:function(e){this.restoreTitle="还原内容",this.restoreForm={action:"Restore",channelContentIds:e.channelId+"_"+e.id,restoreChannelIds:null},this.isRestoreForm=!0},btnRestoreSubmitClick:function(){var e=this;this.$refs.restoreForm.validate(function(t){t&&(e.isRestoreForm=!1,e.apiDelete({siteId:e.siteId,action:e.restoreForm.action,channelContentIds:e.restoreForm.channelContentIds,restoreChannelId:e.restoreForm.restoreChannelIds[e.restoreForm.restoreChannelIds.length-1]},"成功"+e.restoreTitle+"！"))})},btnSelectColumnClick:function(e){var t=_.find(this.searchColumns,function(t){return t.attributeName==e.attributeName});t?this.searchColumns.splice(this.searchColumns.indexOf(t),1):this.searchColumns.push({attributeName:e.attributeName,displayName:e.displayName,value:""})},getColumnEffect:function(e){return _.find(this.searchColumns,function(t){return t.attributeName==e.attributeName})?"dark":"plain"},getContentUrl:function(e){return utils.getRootUrl("redirect",{siteId:e.siteId,channelId:e.channelId,contentId:e.id})},btnTitleClick:function(e){if(e.checked&&e.channelId>0)return!1;utils.openLayer({title:"查看内容",url:utils.getCmsUrl("contentsLayerView",{siteId:this.siteId,channelId:Math.abs(e.channelId),contentId:e.id}),full:!0})},btnSearchClick:function(){var e=this;this.$refs.searchForm.validate(function(t){t&&e.apiList(e.siteId,1)})},btnEditClick:function(e){utils.openLayer({title:"编辑内容",url:this.getEditUrl(e),full:!0,max:!0})},btnAdminClick:function(e){utils.openLayer({title:"管理员查看",url:utils.getCommonUrl("adminLayerView",{adminId:e}),full:!0})},getEditUrl:function(e){return utils.getCmsUrl("editor",{siteId:this.siteId,channelId:e.channelId,contentId:e.id,page:this.page,tabName:utils.getTabName()})},btnLayerClick:function(e){var t={siteId:this.siteId,page:this.page};if(e.channelId?t.channelId=e.channelId:t.channelId=this.siteId,e.contentId&&(t.contentId=e.contentId),e.withContents){if(!this.isContentChecked)return;t.channelContentIds=this.channelContentIdsString}e.url=utils.getCmsUrl("contentsLayer"+e.name,t),utils.openLayer(e)},scrollToTop:function(){document.documentElement.scrollTop=document.body.scrollTop=0},tableRowClassName:function(e){return-1!==this.multipleSelection.indexOf(e.row)?"current-row":""},handleSelectionChange:function(e){this.multipleSelection=e},toggleSelection:function(e){this.$refs.multipleTable.toggleRowSelection(e)},handleCurrentChange:function(e){this.apiList(this.siteId,e)},handleColumnsChange:function(){var e=_.filter(this.columns,function(e){return e.isList}),t=_.map(e,function(e){return e.attributeName});this.apiColumns(t)},getColumnWidth:function(e){return"Sequence"===e.attributeName||"Id"===e.attributeName||"Hits"===e.attributeName||"Downloads"===e.attributeName?70:"ImageUrl"===e.attributeName?100:"Guid"===e.attributeName||"SourceId"===e.attributeName?310:"Title"===e.attributeName?"":$defaultWidth},getColumnMinWidth:function(e){return"Title"===e.attributeName?400:""},btnCloseClick:function(){utils.removeTab()}},$vue=new Vue({el:"#main",data:data,methods:methods,computed:{isCheckedLevels:function(){return this.checkedLevels.length!==this.searchForm.checkedLevels.length},isFiltered:function(){return this.checkedLevels.length!==this.searchForm.checkedLevels.length||(!!(this.searchForm.isTop||this.searchForm.isRecommend||this.searchForm.isHot||this.searchForm.isColor)||(this.searchForm.groupNames.length>0||this.searchForm.tagNames.length>0))},isContentChecked:function(){return this.multipleSelection.length>0},channelContentIds:function(){for(var e=[],t=0;t<this.multipleSelection.length;t++){var n=this.multipleSelection[t];e.push({channelId:n.channelId,id:n.id})}return e},channelContentIdsString:function(){for(var e=[],t=0;t<this.multipleSelection.length;t++){var n=this.multipleSelection[t];e.push(n.channelId+"_"+n.id)}return e.join(",")}},created:function(){utils.keyPress(this.btnSearchClick,this.btnCloseClick),this.apiTree()}});