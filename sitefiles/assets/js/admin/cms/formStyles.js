var $url="/cms/forms/formStyles",$urlImport=$url+"/actions/import",$urlExport=$url+"/actions/export",$urlDelete=$url+"/actions/delete",data=utils.init({siteId:utils.getQueryInt("siteId"),formId:utils.getQueryInt("formId"),navType:"Styles",inputTypes:null,tableName:null,relatedIdentities:null,styles:null,uploadPanel:!1,uploadLoading:!1,uploadList:[]}),methods={runTableStyleLayerAddMultiple:function(){this.apiGet()},runTableStyleLayerEditor:function(){this.apiGet()},runTableStyleLayerValidate:function(){this.apiGet()},apiGet:function(){var t=this;utils.loading(this,!0),$api.get($url,{params:{siteId:this.siteId,formId:this.formId}}).then(function(e){var i=e.data;t.inputTypes=i.inputTypes,t.tableName=i.tableName,t.relatedIdentities=i.relatedIdentities,t.styles=i.styles,t.urlUpload=$apiUrl+$urlImport+"?siteId="+t.siteId+"&formId="+t.formId}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},apiDelete:function(t){var e=this;utils.loading(!0),$api.post($urlDelete,{siteId:this.siteId,formId:this.formId,attributeName:t}).then(function(t){var i=t.data;utils.success("字段删除成功！"),e.styles=i.styles}).catch(function(t){utils.error(t)}).then(function(){utils.loading(e,!1)})},getInputType:function(t){var e=this.inputTypes.find(function(e){return e.value===t});return e?e.label:"文本输入框"},getRules:function(t){return t&&0!==t.length?_.map(t,function(t){return t.message}).join(","):"无验证"},btnNavClick:function(){location.href=utils.getCmsUrl("form"+this.navType,{siteId:this.siteId,formId:this.formId})},btnEditClick:function(t){utils.openLayer({title:"编辑字段",url:utils.getCommonUrl("tableStyleLayerEditor",{tableName:this.tableName,relatedIdentities:this.relatedIdentities,attributeName:t,excludes:"TextEditor,SelectCascading,Customize,Video"})})},btnValidateClick:function(t){utils.openLayer({title:"设置验证规则",url:utils.getCommonUrl("tableStyleLayerValidate",{tableName:this.tableName,relatedIdentities:this.relatedIdentities,attributeName:t})})},btnDeleteClick:function(t){var e=this;utils.alertDelete({title:"删除字段",text:"此操作将删除字段 "+t+"，确定吗？",callback:function(){e.apiDelete(t)}})},btnAddClick:function(){utils.openLayer({title:"新增字段",url:utils.getCommonUrl("tableStyleLayerEditor",{tableName:this.tableName,relatedIdentities:this.relatedIdentities,excludes:"TextEditor,SelectCascading,Customize,Video"})})},btnAddMultipleClick:function(){utils.openLayer({title:"批量新增字段",url:utils.getCommonUrl("tableStyleLayerAddMultiple",{tableName:this.tableName,relatedIdentities:this.relatedIdentities,excludes:"TextEditor,SelectCascading,Customize,Video"})})},btnImportClick:function(){this.uploadPanel=!0},uploadBefore(t){var e=-1!==t.name.indexOf(".zip",t.name.length-".zip".length);return e||utils.error("样式导入文件只能是 Zip 格式!"),e},uploadProgress:function(){utils.loading(this,!0)},uploadSuccess:function(t,e){this.uploadList=[],this.uploadPanel=!1,utils.success("字段导入成功！"),this.apiGet()},uploadError:function(t){this.uploadList=[],utils.loading(this,!1);var e=JSON.parse(t.message);utils.error(e.message)},btnExportClick:function(){var t=this;utils.loading(this,!0),$api.post($urlExport,{siteId:this.siteId,formId:this.formId}).then(function(t){var e=t.data;window.open(e.value)}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},btnCloseClick:function(){utils.removeTab()}},$vue=new Vue({el:"#main",data:data,methods:methods,created:function(){utils.keyPress(null,this.btnCloseClick),this.apiGet()}});