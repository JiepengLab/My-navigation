var $url="/cms/contents/contentsCheck",$defaultWidth=160,data=utils.init({siteId:utils.getQueryInt("siteId"),root:null,siteUrl:null,groupNames:null,tagNames:null,checkedLevels:[],pageContents:null,total:null,pageSize:null,page:1,columns:null,titleColumn:null,bodyColumn:null,permissions:null,tableMaxHeight:999999999999,multipleSelection:[],checkedColumns:[],searchColumns:[],searchForm:{channelIds:[utils.getQueryInt("siteId")],isAllContents:!0,startDate:null,endDate:null,checkedLevels:[],isTop:!1,isRecommend:!1,isHot:!1,isColor:!1,groupNames:[],tagNames:[]}}),methods={apiTree:function(){var t=this;$api.post($url+"/actions/tree",{siteId:this.siteId}).then(function(e){var n=e.data;t.root=n.root,t.siteUrl=n.siteUrl,t.groupNames=n.groupNames,t.tagNames=n.tagNames,t.checkedLevels=n.checkedLevels,t.columns=n.columns,t.titleColumn=n.titleColumn,t.bodyColumn=n.bodyColumn,t.permissions=n.permissions,t.searchColumns.push({attributeName:t.titleColumn.attributeName,displayName:t.titleColumn.displayName,value:""}),t.searchColumns.push({attributeName:t.bodyColumn.attributeName,displayName:t.bodyColumn.displayName,value:""}),t.searchForm.checkedLevels=[0],t.apiList(t.siteId,1)}).catch(function(e){utils.loading(t,!1),utils.error(e)})},apiList:function(t,e,n){for(var i=this,s=[],a=0;a<this.searchForm.channelIds.length;a++){var l=this.searchForm.channelIds[a];Array.isArray(l)?s.push(l[l.length-1]):s.push(l)}var o=[];for(a=0;a<this.searchColumns.length;a++){var r=this.searchColumns[a];r.attributeName&&r.value&&o.push({key:r.attributeName,value:r.value})}utils.loading(this,!0),$api.post($url+"/actions/list",{siteId:this.siteId,channelIds:s,isAllContents:this.searchForm.isAllContents,page:e,items:o,startDate:this.searchForm.startDate,endDate:this.searchForm.endDate,checkedLevels:this.searchForm.checkedLevels,isTop:this.searchForm.isTop,isRecommend:this.searchForm.isRecommend,isHot:this.searchForm.isHot,isColor:this.searchForm.isColor,groupNames:this.searchForm.groupNames,tagNames:this.searchForm.tagNames}).then(function(t){var s=t.data;i.pageContents=s.pageContents,i.total=s.total,i.pageSize=s.pageSize,i.page=e,n&&utils.success(n)}).catch(function(t){utils.error(t)}).then(function(){utils.loading(i,!1),i.scrollToTop()})},apiColumns:function(t){$api.post($url+"/actions/columns",{siteId:this.siteId,attributeNames:t}).then(function(t){t.data}).catch(function(t){utils.error(t)})},getContentTarget:function(t){return"NoLink"==t.linkType?"":"_blank"},btnSelectColumnClick:function(t){var e=_.find(this.searchColumns,function(e){return e.attributeName==t.attributeName});e?this.searchColumns.splice(this.searchColumns.indexOf(e),1):this.searchColumns.push({attributeName:t.attributeName,displayName:t.displayName,value:""})},getColumnEffect:function(t){return _.find(this.searchColumns,function(e){return e.attributeName==t.attributeName})?"dark":"plain"},getContentUrl:function(t){return utils.getRootUrl("redirect",{siteId:t.siteId,channelId:t.channelId,contentId:t.id})},btnTitleClick:function(t){if(t.checked&&t.channelId>0)return!1;utils.openLayer({title:"查看内容",url:utils.getCmsUrl("contentsLayerView",{siteId:this.siteId,channelId:Math.abs(t.channelId),contentId:t.id}),full:!0})},btnSearchClick:function(){var t=this;0!==this.searchForm.checkedLevels.length?this.$refs.searchForm.validate(function(e){e&&t.apiList(t.siteId,1)}):utils.error("请选择审核状态！")},btnEditClick:function(t){utils.addTab("编辑内容",this.getEditUrl(t))},btnAdminClick:function(t){utils.openLayer({title:"管理员查看",url:utils.getCommonUrl("adminLayerView",{adminId:t}),full:!0})},getEditUrl:function(t){return utils.getCmsUrl("editor",{siteId:this.siteId,channelId:t.channelId,contentId:t.id,page:this.page,tabName:utils.getTabName()})},btnLayerClick:function(t){var e={siteId:this.siteId,page:this.page};if(t.channelId?e.channelId=t.channelId:e.channelId=this.siteId,t.contentId&&(e.contentId=t.contentId),t.withContents){if(!this.isContentChecked)return;e.channelContentIds=this.channelContentIdsString}t.url=utils.getCmsUrl("contentsLayer"+t.name,e),utils.openLayer(t)},btnContentStateClick:function(t){utils.openLayer({title:"查看审核状态",url:utils.getCmsUrl("contentsLayerState",{siteId:t.siteId,channelId:t.channelId,contentId:t.id}),full:!0})},scrollToTop:function(){document.documentElement.scrollTop=document.body.scrollTop=0},tableRowClassName:function(t){return-1!==this.multipleSelection.indexOf(t.row)?"current-row":""},handleSelectionChange:function(t){this.multipleSelection=t},toggleSelection:function(t){this.$refs.multipleTable.toggleRowSelection(t)},handleHeaderDragend:function(t,e,n){},handleCurrentChange:function(t){this.apiList(this.siteId,t)},handleColumnsChange:function(){var t=_.filter(this.columns,function(t){return t.isList}),e=_.map(t,function(t){return t.attributeName});this.apiColumns(e)},getColumnWidth:function(t){return"Sequence"===t.attributeName||"Id"===t.attributeName||"Hits"===t.attributeName||"Downloads"===t.attributeName?70:"ImageUrl"===t.attributeName?100:"Guid"===t.attributeName||"SourceId"===t.attributeName?310:"Title"===t.attributeName?"":$defaultWidth},getColumnMinWidth:function(t){return"Title"===t.attributeName?400:""},getUrl:function(t){return t?_.replace(t,"@/",this.siteUrl+"/"):""},btnCloseClick:function(){utils.removeTab()}},$vue=new Vue({el:"#main",data:data,methods:methods,computed:{isFiltered:function(){return!!(this.searchForm.isTop||this.searchForm.isRecommend||this.searchForm.isHot||this.searchForm.isColor)||(this.searchForm.groupNames.length>0||this.searchForm.tagNames.length>0)},isContentChecked:function(){return this.multipleSelection.length>0},channelContentIds:function(){for(var t=[],e=0;e<this.multipleSelection.length;e++){var n=this.multipleSelection[e];t.push({channelId:n.channelId,id:n.id})}return t},channelContentIdsString:function(){for(var t=[],e=0;e<this.multipleSelection.length;e++){var n=this.multipleSelection[e];t.push(n.channelId+"_"+n.id)}return t.join(",")}},created:function(){utils.keyPress(this.btnSearchClick,this.btnCloseClick),this.apiTree()}});