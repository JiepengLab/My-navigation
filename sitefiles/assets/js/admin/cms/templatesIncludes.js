var $url="/cms/templates/templatesIncludes",$urlDelete=$url+"/actions/delete",data=utils.init({siteId:utils.getQueryInt("siteId"),directories:null,allFiles:null,files:null,siteUrl:null,includeDir:null,directoryPaths:[],keyword:"",configPanel:!1,configParent:null,configForm:null}),methods={apiGet:function(){var i=this;utils.loading(this,!0),$api.get($url,{params:{siteId:this.siteId}}).then(function(t){var e=t.data;i.directories=e.directories,i.allFiles=e.files,i.siteUrl=e.siteUrl,i.includeDir=e.includeDir,i.reload()}).catch(function(i){utils.error(i)}).then(function(){utils.loading(i,!1)})},apiDelete:function(i){var t=this;utils.loading(this,!0),$api.post($urlDelete,{siteId:this.siteId,directoryPath:i.directoryPath,fileName:i.fileName}).then(function(e){e.data;t.allFiles.splice(t.allFiles.indexOf(i),1),t.reload(),utils.success("文件删除成功！")}).catch(function(i){utils.error(i)}).then(function(){utils.loading(t,!1)})},apiConfig:function(){var i=this;this.loading=this.$loading(),$api.post($url+"/actions/config",this.configForm).then(function(t){var e=t.data;i.directories=e.directories,i.allFiles=e.files,i.siteUrl=e.siteUrl,i.includeDir=e.includeDir,i.reload(),i.configPanel=!1,utils.success("文件夹路径设置成功!")}).catch(function(i){utils.error(i)}).then(function(){utils.loading(i,!1)})},btnCopyClick:function(i){var t=this;utils.loading(this,!0),$api.post($url+"/actions/copy",{siteId:this.siteId,templateId:i.id}).then(function(i){var e=i.data;t.directories=e.directories,t.allFiles=e.files,t.reload(),utils.success("快速复制成功！")}).catch(function(i){utils.error(i)}).then(function(){utils.loading(t,!1)})},btnDeleteClick:function(i){var t=this;utils.alertDelete({title:"删除文件",text:"此操作将删除文件 "+i.directoryPath+"/"+i.fileName+"，确认吗？",callback:function(){t.apiDelete(i)}})},btnAddClick:function(){utils.addTab("新增包含文件",this.getEditorUrl("",""))},btnEditClick:function(i){utils.addTab("编辑:"+i.directoryPath+"/"+i.fileName,this.getEditorUrl(i.directoryPath,i.fileName))},getEditorUrl:function(i,t){return utils.getCmsUrl("templatesAssetsEditor",{siteId:this.siteId,directoryPath:i,fileName:t,fileType:"html",tabName:utils.getTabName()})},getPageUrl:function(i){return this.siteUrl+"/"+i},reload:function(){var i=this;this.files=_.filter(this.allFiles,function(t){var e=!0,l=!0;if(i.directoryPaths.length>0){e=!1;for(var n=0;n<i.directoryPaths.length;n++){var s=i.directoryPaths[n][i.directoryPaths[n].length-1];t.directoryPath==s&&(e=!0)}}return i.keyword&&(l=-1!==(t.directoryPath||"").indexOf(i.keyword)||-1!==(t.fileName||"").indexOf(i.keyword)),e&&l})},btnConfigClick:function(){this.configForm={siteId:this.siteId,includeDir:this.includeDir},this.configPanel=!0},btnConfigCancelClick:function(){this.configPanel=!1},btnConfigSubmitClick:function(){var i=this;this.$refs.configForm.validate(function(t){t&&i.apiConfig()})},btnCloseClick:function(){utils.removeTab()}},$vue=new Vue({el:"#main",data:data,methods:methods,created:function(){var i=this;utils.keyPress(function(){i.configPanel&&i.btnConfigSubmitClick()},function(){i.configPanel?i.btnConfigCancelClick():i.btnCloseClick()}),this.apiGet()}});