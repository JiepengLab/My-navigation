var $url="/cms/settings/settingsSite",data=utils.init({siteId:utils.getQueryInt("siteId"),siteUrl:null,pageType:null,form:null,styles:null,relatedFields:null,settings:null,files:[]}),methods={runFormLayerImageUploadText:function(t,e,i){this.insertText(t,e,i)},runFormLayerImageUploadEditor:function(t,e){this.insertEditor(t,e)},runMaterialLayerImageSelect:function(t,e,i){this.insertText(t,e,i)},runFormLayerFileUpload:function(t,e,i){this.insertText(t,e,i)},runMaterialLayerFileSelect:function(t,e,i){this.insertText(t,e,i)},runFormLayerVideoUpload:function(t,e,i){this.insertText(t,e,i)},runMaterialLayerVideoSelect:function(t,e,i){this.insertText(t,e,i)},runEditorLayerImage:function(t,e){this.insertEditor(t,e)},insertText:function(t,e,i){(this.form[utils.getCountName(t)]||0)<=e&&(this.form[utils.getCountName(t)]=e),this.form[utils.getExtendName(t,e)]=i,this.form=_.assign({},this.form)},insertEditor:function(t,e){t||(t="Body"),e&&utils.getEditor(t).execCommand("insertHTML",e)},apiGet:function(){var t=this;utils.loading(this,!0),$api.get($url,{params:{siteId:this.siteId}}).then(function(e){var i=e.data;t.siteUrl=i.siteUrl,t.styles=i.styles,t.relatedFields=i.relatedFields,t.form=i.entity,t.settings=i.settings,t.loadEditor(i)}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},apiSubmit:function(){var t=this;utils.loading(this,!0),$api.post($url,_.assign({siteId:this.siteId},this.form)).then(function(t){t.data;utils.success("站点设置保存成功！")}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},btnImageSelectClick:function(t){var e=t.inputType,i=t.attributeName,n=t.no,s=t.type;"uploadedImages"===s?this.btnLayerClick({title:"选择已上传图片",name:"formLayerImageSelect",inputType:e,attributeName:i,no:n,full:!0}):"materialImages"===s?this.btnLayerClick({title:"选择素材库图片",name:"materialLayerImageSelect",inputType:e,attributeName:i,no:n,full:!0}):"cloudImages"===s&&utils.openLayer({title:"选择免版权图库",url:utils.getCloudsUrl("layerImagesSelect",{attributeName:t.attributeName,inputType:e,no:t.no})})},btnSiteStylesClick:function(){location.href=utils.getCmsUrl("settingsStyleSite",{siteId:this.siteId,returnUrl:location.href})},loadEditor:function(t){var e=this;setTimeout(function(){for(var t=0;t<e.styles.length;t++){var i=e.styles[t];utils.toCamelCase(i.attributeName);if("TextEditor"===i.inputType){var n=utils.getEditor(i.attributeName);n.attributeName=i.attributeName,n.ready(function(){this.addListener("contentChange",function(){e.form[this.attributeName]=this.getContent()})})}}},100)},btnExtendAddClick:function(t){var e=this.form[utils.getCountName(t.attributeName)]+1;this.form[utils.getCountName(t.attributeName)]=e,this.form[utils.getExtendName(t.attributeName,e)]="",this.form=_.assign({},this.form)},btnExtendRemoveClick:function(t){var e=this.form[utils.getCountName(t.attributeName)];this.form[utils.getCountName(t.attributeName)]=e-1,this.form[utils.getExtendName(t.attributeName,e)]="",this.form=_.assign({},this.form)},btnExtendPreviewClick:function(t,e){for(var i=this.form[utils.getCountName(t)],n=[],s=0;s<=i;s++){var a=this.form[utils.getExtendName(t,s)];a=utils.getUrl(this.siteUrl,a),n.push({src:a})}layer.photos({photos:{start:e,data:n},anim:5})},btnLayerClick:function(t){var e={siteId:this.siteId,attributeName:t.attributeName};t.no&&(e.no=t.no),t.inputType&&(e.inputType=t.inputType);var i={title:t.title,url:utils.getCommonUrl(t.name,e)};t.full||(i.width=t.width?t.width:700,i.height=t.height?t.height:500),utils.openLayer(i)},btnSubmitClick:function(){var t=this;this.$refs.form.validate(function(e){e&&t.apiSubmit()})},btnCloseClick:function(){utils.removeTab()}},$vue=new Vue({el:"#main",data:data,methods:methods,created:function(){utils.keyPress(this.btnSubmitClick,this.btnCloseClick),this.apiGet()}});