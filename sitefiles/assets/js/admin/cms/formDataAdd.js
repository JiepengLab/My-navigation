var $url="/cms/forms/formDataAdd",$urlDeleteFile=$url+"/actions/deleteFile",data=utils.init({siteId:utils.getQueryInt("siteId"),formId:utils.getQueryInt("formId"),dataId:utils.getQueryInt("dataId"),navType:"Data",siteUrl:null,styles:[],uploadUrl:null,files:[],form:null}),methods={runFormLayerImageUploadText:function(t,i,e){this.insertText(t,i,e)},runFormLayerFileUpload:function(t,i,e){this.insertText(t,i,e)},runMaterialLayerFileSelect:function(t,i,e){this.insertText(t,i,e)},insertText:function(t,i,e){(this.form[utils.getCountName(t)]||0)<=i&&(this.form[utils.getCountName(t)]=i),this.form[utils.getExtendName(t,i)]=e,this.form=_.assign({},this.form)},getUploadUrl:function(t){return this.uploadUrl+"&fieldId="+t.id},imageUploaded:function(t,i){if(!t){var e=JSON.parse(i.serverId);_.find(this.styles,function(t){return t.id===e.fieldId}).value=e.value}},imageRemoved:function(t){t.value=[]},apiGet:function(){var t=this;utils.loading(this,!0),$api.get($url,{params:{siteId:this.siteId,formId:this.formId,dataId:this.dataId}}).then(function(i){var e=i.data;t.siteUrl=e.siteUrl,t.styles=e.styles,t.form=utils.getForm(e.styles,e.formData)}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},apiSubmit:function(){var t=this;utils.loading(!0),$api.post($url+"?siteId="+this.siteId,this.form).then(function(i){i.data;utils.success("数据保存成功！"),t.navType="Data",t.btnNavClick()}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},getValue:function(t){for(var i=0;i<this.styles.length;i++){var e=this.styles[i];if(e.attributeName===t)return e.value}return""},setValue:function(t,i){for(var e=0;e<this.styles.length;e++){var s=this.styles[e];s.attributeName===t&&(s.value=i)}},btnImageClick:function(t){top.utils.openImagesLayer([t])},btnSubmitClick:function(){var t=this;this.$refs.form.validate(function(i){i&&t.apiSubmit()})},btnReturnClick:function(){this.navType="Data",this.btnNavClick()},btnNavClick:function(){location.href=utils.getCmsUrl("form"+this.navType,{siteId:this.siteId,formId:this.formId})},btnExtendPreviewClick:function(t,i){var e=[],s=this.form[utils.getExtendName(t,i)];s=utils.getUrl(this.siteUrl,s),e.push({src:s}),layer.photos({photos:{start:i,data:e},anim:5})},btnLayerClick:function(t){var i={siteId:this.siteId,attributeName:t.attributeName};t.no&&(i.no=t.no);var e={title:t.title,url:utils.getCommonUrl(t.name,i)};t.full||(e.width=t.width?t.width:700,e.height=t.height?t.height:500),utils.openLayer(e)}},$vue=new Vue({el:"#main",data:data,methods:methods,created:function(){utils.keyPress(this.btnSubmitClick,this.btnReturnClick),this.apiGet()}});