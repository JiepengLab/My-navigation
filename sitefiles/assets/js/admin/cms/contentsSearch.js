var $url="/cms/contents/contentsSearch",$defaultWidth=160,data=utils.init({siteId:utils.getQueryInt("siteId"),root:null,siteUrl:null,groupNames:null,tagNames:null,checkedLevels:[],pageContents:null,total:null,pageSize:null,page:1,titleColumn:null,bodyColumn:null,columns:null,permissions:null,menus:null,tableMaxHeight:999999999999,multipleSelection:[],checkedColumns:[],searchColumns:[],searchForm:{searchType:"All",channelIds:[utils.getQueryInt("siteId")],isAllContents:!0,startDate:null,endDate:null,checkedLevels:[],isTop:!1,isRecommend:!1,isHot:!1,isColor:!1,groupNames:[],tagNames:[]}}),methods={apiTree:function(){var t=this;$api.post($url+"/actions/tree",{siteId:this.siteId}).then(function(e){var n=e.data;t.root=n.root,t.siteUrl=n.siteUrl,t.groupNames=n.groupNames,t.tagNames=n.tagNames,t.checkedLevels=n.checkedLevels,t.titleColumn=n.titleColumn,t.bodyColumn=n.bodyColumn,t.columns=n.columns,t.permissions=n.permissions,t.permissions.isAdd=!1;var i=utils.getQueryString("keyword")||"";t.searchColumns.push({attributeName:t.titleColumn.attributeName,displayName:t.titleColumn.displayName,value:i}),t.searchColumns.push({attributeName:t.bodyColumn.attributeName,displayName:t.bodyColumn.displayName,value:""}),t.searchForm.checkedLevels=_.map(n.checkedLevels,function(t){return t.label}),i?t.apiList(t.siteId,1):utils.loading(t,!1)}).catch(function(e){utils.loading(t,!1),utils.error(e)})},apiList:function(t,e,n){for(var i=this,s=[],l=0;l<this.searchForm.channelIds.length;l++){var a=this.searchForm.channelIds[l];Array.isArray(a)?s.push(a[a.length-1]):s.push(a)}var r=[];for(l=0;l<this.searchColumns.length;l++){var o=this.searchColumns[l];o.attributeName&&o.value&&r.push({key:o.attributeName,value:o.value})}utils.loading(this,!0),$api.post($url+"/actions/list",{siteId:this.siteId,searchType:this.searchForm.searchType,channelIds:s,isAllContents:this.searchForm.isAllContents,startDate:this.searchForm.startDate,endDate:this.searchForm.endDate,items:r,page:e,isAdvanced:this.isAdvanced,isCheckedLevels:this.isCheckedLevels,checkedLevels:this.searchForm.checkedLevels,isTop:this.searchForm.isTop,isRecommend:this.searchForm.isRecommend,isHot:this.searchForm.isHot,isColor:this.searchForm.isColor,groupNames:this.searchForm.groupNames,tagNames:this.searchForm.tagNames}).then(function(t){var s=t.data;i.pageContents=s.pageContents,i.total=s.total,i.pageSize=s.pageSize,i.page=e,n&&utils.success(n)}).catch(function(t){utils.error(t)}).then(function(){utils.loading(i,!1),i.scrollToTop()})},apiColumns:function(t){$api.post($url+"/actions/columns",{siteId:this.siteId,attributeNames:t}).then(function(t){t.data}).catch(function(t){utils.error(t)})},btnSelectColumnClick:function(t){var e=_.find(this.searchColumns,function(e){return e.attributeName==t.attributeName});e?this.searchColumns.splice(this.searchColumns.indexOf(e),1):this.searchColumns.push({attributeName:t.attributeName,displayName:t.displayName,value:""})},getColumnEffect:function(t){return _.find(this.searchColumns,function(e){return e.attributeName==t.attributeName})?"dark":"plain"},getContentUrl:function(t){return"NoLink"==t.linkType?"javascript:;":t.referenceId>0&&t.sourceId>0?utils.getRootUrl("redirect",{siteId:t.siteId,channelId:t.sourceId,contentId:t.referenceId}):utils.getRootUrl("redirect",{siteId:t.siteId,channelId:t.channelId,contentId:t.id})},getContentTarget:function(t){return"NoLink"==t.linkType?"":"_blank"},btnTitleClick:function(t){if(t.checked&&t.channelId>0)return!1;utils.openLayer({title:"查看内容",url:utils.getCmsUrl("contentsLayerView",{siteId:this.siteId,channelId:Math.abs(t.channelId),contentId:t.id}),full:!0})},btnTabClick:function(){this.pageContents&&this.btnSearchClick()},btnSearchClick:function(){var t=this;this.$refs.searchForm.validate(function(e){e&&t.apiList(t.siteId,1)})},btnEditClick:function(t){utils.addTab("编辑内容",this.getEditUrl(t))},btnAdminClick:function(t){utils.openLayer({title:"管理员查看",url:utils.getCommonUrl("adminLayerView",{adminId:t}),full:!0})},getAddUrl:function(){return utils.getCmsUrl("editor",{siteId:this.siteId,channelId:this.channelId,page:this.page,tabName:utils.getTabName()})},getEditUrl:function(t){return utils.getCmsUrl("editor",{siteId:this.siteId,channelId:t.channelId,contentId:t.id,page:this.page,tabName:utils.getTabName()})},btnAddClick:function(){utils.addTab("添加内容",this.getAddUrl())},btnImportClick:function(t){"Word"===t?this.btnLayerClick({title:"批量导入Word",name:"Word",full:!0}):"Import"===t&&this.btnLayerClick({title:"批量导入",name:"Import",full:!0})},btnMoreClick:function(t){"Group"===t?this.btnLayerClick({title:"批量设置分组",name:"Group",width:700,height:400,withContents:!0}):"Tag"===t?this.btnLayerClick({title:"批量设置标签",name:"Tag",width:700,height:400,withContents:!0}):"Copy"===t?this.btnLayerClick({title:"批量复制",name:"Copy",withContents:!0}):"ExportAll"===t?this.btnLayerClick({title:"导出全部",name:"Export",full:!0}):"ExportSelected"===t?this.btnLayerClick({title:"导出选中",name:"Export",full:!0,withContents:!0}):"Arrange"===t?this.btnLayerClick({title:"整理排序",name:"Arrange",width:550,height:350}):"Hits"===t&&this.btnLayerClick({title:"设置点击量",name:"Hits",width:450,height:320,withContents:!0})},btnCreateClick:function(){var t=this;this.isContentChecked&&(utils.loading(this,!0),$api.post($url+"/actions/create",{siteId:t.siteId,channelContentIds:this.channelContentIdsString}).then(function(e){e.data;utils.addTab("生成进度查看",utils.getCmsUrl("createStatus",{siteId:t.siteId}))}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)}))},btnLayerClick:function(t){var e={siteId:this.siteId,page:this.page};if(t.channelId?e.channelId=t.channelId:e.channelId=this.siteId,t.contentId&&(e.contentId=t.contentId),t.withContents){if(!this.isContentChecked)return;e.channelContentIds=this.channelContentIdsString}t.url=utils.getCmsUrl("contentsLayer"+t.name,e),utils.openLayer(t)},btnContentStateClick:function(t){utils.openLayer({title:"查看审核状态",url:utils.getCmsUrl("contentsLayerState",{siteId:t.siteId,channelId:t.channelId,contentId:t.id}),full:!0})},scrollToTop:function(){document.documentElement.scrollTop=document.body.scrollTop=0},tableRowClassName:function(t){return-1!==this.multipleSelection.indexOf(t.row)?"current-row":""},handleSelectionChange:function(t){this.multipleSelection=t},toggleSelection:function(t){this.$refs.multipleTable.toggleRowSelection(t)},handleCurrentChange:function(t){this.apiList(this.siteId,t)},handleHeaderDragend:function(t,e,n){},handleColumnsChange:function(){var t=_.filter(this.columns,function(t){return t.isList}),e=_.map(t,function(t){return t.attributeName});this.apiColumns(e)},btnCloseClick:function(){utils.removeTab()}},$vue=new Vue({el:"#main",data:data,methods:methods,computed:{isAdvanced:function(){if("All"!==this.searchForm.searchType)return!0;if(this.searchForm.channelIds.length>1)return!0;if(this.checkedLevels.length!==this.searchForm.checkedLevels.length)return!0;if(this.searchForm.isTop||this.searchForm.isRecommend||this.searchForm.isHot||this.searchForm.isColor)return!0;if(this.searchForm.groupNames.length>0||this.searchForm.tagNames.length>0)return!0;if(this.searchForm.startDate||this.searchForm.endDate)return!0;for(var t=0;t<this.searchColumns.length;t++)if(this.searchColumns[t].value)return!0;return!1},isCheckedLevels:function(){return this.checkedLevels.length!==this.searchForm.checkedLevels.length},isFiltered:function(){return this.checkedLevels.length!==this.searchForm.checkedLevels.length||(!!(this.searchForm.isTop||this.searchForm.isRecommend||this.searchForm.isHot||this.searchForm.isColor)||(this.searchForm.groupNames.length>0||this.searchForm.tagNames.length>0))},isContentChecked:function(){return this.multipleSelection.length>0},channelContentIds:function(){for(var t=[],e=0;e<this.multipleSelection.length;e++){var n=this.multipleSelection[e];t.push({channelId:n.channelId,id:n.id})}return t},channelContentIdsString:function(){for(var t=[],e=0;e<this.multipleSelection.length;e++){var n=this.multipleSelection[e];t.push(n.channelId+"_"+n.id)}return t.join(",")}},created:function(){utils.keyPress(this.btnSearchClick,this.btnCloseClick),this.apiTree()}});