var $url="/cms/templates/templatesAssets",$urlDelete=$url+"/actions/delete",$urlConfig=$url+"/actions/config",data=utils.init({siteId:utils.getQueryInt("siteId"),directories:null,allFiles:null,files:null,siteUrl:null,cssDir:null,jsDir:null,imagesDir:null,fileType:utils.getQueryString("fileType")||"css",directoryPaths:[],keyword:"",configPanel:!1,configParent:null,configForm:null}),methods={apiGet:function(){var i=this;utils.loading(this,!0),$api.get($url,{params:{siteId:this.siteId,fileType:this.fileType}}).then(function(t){var e=t.data;i.directoryPaths=[],i.keyword="",i.directories=e.directories,i.allFiles=e.files,i.siteUrl=e.siteUrl,i.cssDir=e.cssDir,i.jsDir=e.jsDir,i.imagesDir=e.imagesDir,i.reload()}).catch(function(i){utils.error(i)}).then(function(){utils.loading(i,!1)})},apiDelete:function(i){var t=this;utils.loading(this,!0),$api.post($urlDelete,{siteId:this.siteId,fileType:this.fileType,directoryPath:i.directoryPath,fileName:i.fileName}).then(function(e){e.data;t.allFiles.splice(t.allFiles.indexOf(i),1),t.reload(),utils.success("文件删除成功！")}).catch(function(i){utils.error(i)}).then(function(){utils.loading(t,!1)})},apiConfig:function(){var i=this;this.loading=this.$loading(),$api.post($urlConfig,this.configForm).then(function(t){t.data;i.configPanel=!1,utils.success("文件夹路径设置成功!"),i.apiGet()}).catch(function(i){utils.error(i)}).then(function(){utils.loading(i,!1)})},getFileType:function(i){return"css"===i?"样式文件":"js"===i?"脚本文件":"images"===i?"图片文件":""},btnNavClick:function(){this.apiGet()},btnDeleteClick:function(i){var t=this;utils.alertDelete({title:"删除文件",text:"此操作将删除文件 "+i.directoryPath+"/"+i.fileName+"，确认吗？",callback:function(){t.apiDelete(i)}})},btnAddClick:function(i){utils.addTab("新增"+this.getFileType(i),this.getEditorUrl("","",i))},btnEditClick:function(i){if("images"!=this.fileType)utils.addTab("编辑:"+i.directoryPath+"/"+i.fileName,this.getEditorUrl(i.directoryPath,i.fileName,i.fileType));else{var t=this.getPageUrl(i.directoryPath+"/"+i.fileName);window.open(t)}},getEditorUrl:function(i,t,e){return utils.getCmsUrl("templatesAssetsEditor",{siteId:this.siteId,directoryPath:i,fileName:t,fileType:e,tabName:utils.getTabName()})},reload:function(){var i=this;this.files=_.filter(this.allFiles,function(t){var e=!0,s=!0;if(i.directoryPaths.length>0){e=!1;for(var l=0;l<i.directoryPaths.length;l++){var n=i.directoryPaths[l][i.directoryPaths[l].length-1];t.directoryPath==n&&(e=!0)}}return i.keyword&&(s=-1!==(t.directoryPath||"").indexOf(i.keyword)||-1!==(t.fileName||"").indexOf(i.keyword)),e&&s})},getPageUrl:function(i){return this.siteUrl+"/"+i},btnConfigClick:function(){this.configForm={siteId:this.siteId,fileType:this.fileType,cssDir:this.cssDir,jsDir:this.jsDir,imagesDir:this.imagesDir},this.configPanel=!0},btnConfigCancelClick:function(){this.configPanel=!1},btnConfigSubmitClick:function(){var i=this;this.$refs.configForm.validate(function(t){t&&i.apiConfig()})},getUploadUrl:function(){var i="";if(this.directoryPaths.length>0){var t=this.directoryPaths[this.directoryPaths.length-1];i=t[t.length-1]}return $apiUrl+$url+"/actions/upload?siteId="+this.siteId+"&fileType="+this.fileType+"&directories="+encodeURIComponent(i)},uploadBefore:i=>!0,uploadProgress:function(){utils.loading(this,!0)},uploadSuccess:function(i){utils.success("文件上传成功!"),this.apiGet()},uploadError:function(i){utils.loading(this,!1);var t=JSON.parse(i.message);utils.error(t.message)},btnCloseClick:function(){utils.removeTab()}},$vue=new Vue({el:"#main",data:data,methods:methods,created:function(){var i=this;utils.keyPress(function(){i.configPanel&&i.btnConfigSubmitClick()},function(){i.configPanel?i.btnConfigCancelClick():i.btnCloseClick()}),this.apiGet()}});