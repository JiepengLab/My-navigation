var $url="/cms/forms/formData",$urlImport=$url+"/actions/import",$urlExport=$url+"/actions/export",$urlColumns=$url+"/actions/columns",$urlDelete=$url+"/actions/delete",data=utils.init({siteId:utils.getQueryInt("siteId"),formId:utils.getQueryInt("formId"),navType:"Data",styles:null,allAttributeNames:[],listAttributeNames:[],isReply:!1,total:null,pageSize:null,page:1,items:[],columns:null,uploadPanel:!1,uploadLoading:!1,uploadList:[],multipleSelection:[],searchForm:{keyword:"",startDate:null,endDate:null}}),methods={apiGet:function(t){var e=this;utils.loading(this,!0),$api.get($url,{params:{siteId:this.siteId,formId:this.formId,page:t,keyword:this.searchForm.keyword,startDate:this.searchForm.startDate,endDate:this.searchForm.endDate}}).then(function(t){var i=t.data;e.styles=i.styles,e.allAttributeNames=i.allAttributeNames,e.listAttributeNames=i.listAttributeNames,e.isReply=i.isReply,e.items=i.items,e.total=i.total,e.pageSize=i.pageSize,e.columns=i.columns}).catch(function(t){utils.error(t)}).then(function(){utils.loading(e,!1)})},apiDelete:function(t){var e=this;utils.loading(!0),$api.post($urlDelete,{siteId:this.siteId,formId:this.formId,dataIds:t}).then(function(t){t.data;e.apiGet(1)}).catch(function(t){utils.error(t)}).then(function(){utils.loading(e,!1)})},apiColumns:function(t){var e=this;$api.post($urlColumns,{siteId:this.siteId,formId:this.formId,attributeNames:t}).then(function(i){i.data;e.listAttributeNames=t}).catch(function(t){utils.error(t)})},handleCurrentChange:function(t){this.apiGet(t)},handleSelectionChange:function(t){this.multipleSelection=t},handleColumnsChange:function(){var t=_.filter(this.columns,function(t){return t.isList}),e=_.map(t,function(t){return t.attributeName});this.apiColumns(e)},btnEditClick:function(t){location.href=utils.getCmsUrl("formDataAdd",{siteId:this.siteId,formId:this.formId,dataId:t})},btnReplyClick:function(t){utils.openLayer({title:"回复",url:utils.getCmsUrl("formDataLayerReply",{siteId:this.siteId,formId:this.formId,dataId:t})})},btnDeleteClick:function(t){var e=this;utils.alertDelete({title:"删除数据",text:"此操作将删除数据，确定吗？",callback:function(){e.apiDelete([t])}})},btnDeleteSelectedClick:function(){var t=this;utils.alertDelete({title:"删除所选数据",text:"此操作将删除所选数据，确定吗？",callback:function(){t.apiDelete(t.dataIds)}})},btnImportClick:function(){this.uploadPanel=!0},uploadBefore(t){var e=-1!==t.name.indexOf(".xlsx",t.name.length-".xlsx".length);return e||utils.error("表单数据导入文件只能是 Excel 格式!"),e},uploadProgress:function(){utils.loading(this,!0)},uploadSuccess:function(t,e){this.uploadPanel=!1,utils.success("成功导入表单数据！"),this.apiGet()},uploadError:function(t){utils.loading(this,!1);var e=JSON.parse(t.message);utils.error(e.message)},btnExportClick:function(){var t=this;utils.loading(!0),$api.post($urlExport,{siteId:this.siteId,formId:this.formId}).then(function(t){var e=t.data;utils.success("数据导出成功！"),window.open(e.value)}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},getAttributeText:function(t){return this.columns.find(function(e){return e.attributeName===t}).displayName},getAttributeType:function(t){var e=_.find(this.styles,function(e){return e.attributeName===t});return e&&e.inputType?e.inputType:"Text"},getAttributeValue:function(t,e){return utils.getValue(this.styles,t,e)},largeImage:function(t,e){var i=this.getAttributeValue(t,e);swal.fire({imageUrl:i,showConfirmButton:!1})},btnDataClick:function(t){utils.openLayer({title:"数据查看",url:utils.getCmsUrl("formDataLayerView",{siteId:this.siteId,formId:this.formId,dataId:t.id})})},btnAddClick:function(){this.navType="DataAdd",this.btnNavClick()},btnNavClick:function(){location.href=utils.getCmsUrl("form"+this.navType,{siteId:this.siteId,formId:this.formId})},btnSearchClick:function(){this.apiGet(1)},btnCloseClick:function(){utils.removeTab()}},$vue=new Vue({el:"#main",data:data,methods:methods,computed:{isChecked:function(){return this.multipleSelection.length>0},dataIds:function(){for(var t=[],e=0;e<this.multipleSelection.length;e++){var i=this.multipleSelection[e];t.push(i.id)}return t}},created:function(){utils.keyPress(null,this.btnCloseClick),this.urlUpload=$apiUrl+$urlImport+"?siteId="+this.siteId+"&formId="+this.formId,this.apiGet(1)}});