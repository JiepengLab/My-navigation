var $url="/cms/create/createPage",data=utils.init({homepage:"/cms/createChannels/",siteId:utils.getQueryInt("siteId"),type:utils.getQueryString("type"),isAllChecked:!1,isDescendent:!1,isChannelPage:"Channel"===utils.getQueryString("type"),isContentPage:"Content"===utils.getQueryString("type"),scope:"all",channels:null,allChannelIds:null,channelTemplates:null,contentTemplates:null,expandedChannelIds:[],filterText:"",filterChannelTemplateId:0,filterContentTemplateId:0,defaultChannelTemplate:null,defaultContentTemplate:null,channelIds:[],channelTemplateId:0,contentTemplateId:0}),methods={apiGet:function(){var e=this;utils.loading(this,!0),$api.get($url,{params:{siteId:this.siteId,parentId:this.siteId,type:this.type}}).then(function(t){var n=t.data;e.channels=[n.channels],e.allChannelIds=n.allChannelIds,e.channelTemplates=n.channelTemplates,e.contentTemplates=n.contentTemplates,e.expandedChannelIds=[e.siteId],e.defaultChannelTemplate=_.find(e.channelTemplates,function(e){return e.default})||{id:0},e.defaultContentTemplate=_.find(e.contentTemplates,function(e){return e.default})||{id:0},e.channelTemplateId=e.defaultChannelTemplate.id,e.contentTemplateId=e.defaultContentTemplate.id}).catch(function(e){utils.error(e)}).then(function(){utils.loading(e,!1)})},apiCreate:function(){var e=this;utils.loading(this,!0),$api.post($url,{siteId:this.siteId,type:this.type,channelIdList:this.isAllChecked?[]:this.channelIds,isAllChecked:this.isAllChecked,isDescendent:this.isDescendent,isChannelPage:this.isChannelPage,isContentPage:this.isContentPage,scope:this.scope}).then(function(t){location.href=utils.getCmsUrl("createStatus",{siteId:e.siteId})}).catch(function(e){utils.error(e)})},apiCreateIndex:function(){var e=this;$api.post($url,{siteId:this.siteId,type:this.type,channelIdList:[this.siteId],isAllChecked:!1,isDescendent:!1,isChannelPage:!0,isContentPage:!1}).then(function(t){location.href=utils.getCmsUrl("createStatus",{siteId:e.siteId})}).catch(function(e){utils.error(e)})},apiCreateAll:function(){var e=this;$api.post($url+"/all",{siteId:this.siteId}).then(function(t){location.href=utils.getCmsUrl("createStatus",{siteId:e.siteId})}).catch(function(e){utils.error(e)})},filterNode:function(e,t){return!e||(e.channelName&&e.channelTemplateId&&e.contentTemplateId?-1!==t.label.indexOf(e.channelName)&&t.channelTemplateId===e.channelTemplateId&&t.contentTemplateId===e.contentTemplateId:e.channelName&&e.channelTemplateId?-1!==t.label.indexOf(e.channelName)&&t.channelTemplateId===e.channelTemplateId:e.channelName&&e.contentTemplateId?-1!==t.label.indexOf(e.channelName)&&t.contentTemplateId===e.contentTemplateId:e.channelTemplateId&&e.contentTemplateId?t.channelTemplateId===e.channelTemplateId&&t.contentTemplateId===e.contentTemplateId:e.channelName?-1!==t.label.indexOf(e.channelName):e.contentTemplateId?t.contentTemplateId===e.contentTemplateId:!e.channelTemplateId||t.channelTemplateId===e.channelTemplateId)},getChannelTemplateName:function(e){var t=_.find(this.channelTemplates,function(t){return t.id===e});return(t?t.templateName:this.defaultChannelTemplate.templateName)||"系统栏目模板"},getContentTemplateName:function(e){var t=_.find(this.contentTemplates,function(t){return t.id===e});return(t?t.templateName:this.defaultContentTemplate.templateName)||"系统内容模板"},selectAll:function(e){e?this.$refs.tree.setCheckedKeys(this.allChannelIds):this.$refs.tree.setCheckedKeys([])},handleCheckChange(){this.channelIds=this.$refs.tree.getCheckedKeys()},btnCreateClick:function(){this.apiCreate()},getChannelUrl:function(e){return utils.getRootUrl("redirect",{siteId:this.siteId,channelId:e.value})},btnCloseClick:function(){utils.removeTab()}},$vue=new Vue({el:"#main",data:data,methods:methods,watch:{filterText:function(e){this.$refs.tree.filter({channelName:e,channelTemplateId:this.filterChannelTemplateId,contentTemplateId:this.filterContentTemplateId})},filterChannelTemplateId:function(e){this.$refs.tree.filter({channelName:this.filterText,channelTemplateId:e,contentTemplateId:this.filterContentTemplateId})},filterContentTemplateId:function(e){this.$refs.tree.filter({channelName:this.filterText,channelTemplateId:this.filterChannelTemplateId,contentTemplateId:e})}},created:function(){utils.keyPress(this.btnCreateClick,this.btnCloseClick),"Index"===this.type?(this.homepage="/cms/createIndex/",this.apiCreateIndex()):"Channel"===this.type?(this.homepage="/cms/createChannels/",this.apiGet()):"Content"===this.type?(this.homepage="/cms/createContents/",this.apiGet()):"All"===this.type&&(this.homepage="/cms/createAll/",this.apiCreateAll())}});