var $url="/cms/forms/formTemplates",$urlDelete=$url+"/actions/delete",$urlExport=$url+"/actions/export",$urlImport=$url+"/actions/import",data=utils.init({siteId:utils.getQueryInt("siteId"),formId:utils.getQueryInt("formId"),forms:null,templates:null,siteUrl:null,name:null,templateHtml:null,urlUpload:null,files:[]}),methods={apiGet:function(){var t=this;utils.loading(this,!0),$api.get($url,{params:{siteId:this.siteId}}).then(function(e){var i=e.data;t.forms=i.forms,t.templates=i.templates,t.siteUrl=i.siteUrl}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},apiDelete:function(t){var e=this;utils.loading(!0),$api.post($urlDelete,{siteId:e.siteId,name:t.name}).then(function(t){t.data;e.apiGet()}).catch(function(t){utils.error(t)}).then(function(){utils.loading(e,!1)})},getTemplatePath:function(t){return t.isSystem?"/sitefiles/assets/forms/"+t.name+"/index.html":_.trimEnd(this.siteUrl,"/")+"/forms/"+t.name+"/index.html"},getCode:function(t){return'<stl:form name="表单名称" type="'+t.name+'"></stl:form>'},btnExportClick:function(t){var e=this;utils.loading(this,!0),$api.post($urlExport,{siteId:this.siteId,isSystem:t.isSystem,name:t.name}).then(function(t){var e=t.data;window.open(e.value)}).catch(function(t){utils.error(t)}).then(function(){utils.loading(e,!1)})},btnHtmlClick:function(t){var e=utils.getCmsUrl("formTemplateHtml",{siteId:this.siteId,isSystem:t.isSystem,name:t.name});utils.addTab("代码编辑",e)},btnEditClick:function(t){utils.openLayer({title:"模板设置",url:utils.getCmsUrl("formTemplatesLayerEdit",{siteId:this.siteId,isSystem:t.isSystem,name:t.name,isClone:!1,isHtml:!1}),width:500,height:300})},btnCloneClick:function(t){utils.openLayer({title:"克隆模板",url:utils.getCmsUrl("formTemplatesLayerEdit",{siteId:this.siteId,isSystem:t.isSystem,name:t.name,isClone:!0,isHtml:!1}),width:500,height:300})},btnDeleteClick:function(t){var e=this;utils.alertDelete({title:"删除模板",text:"此操作将删除模板"+t.name+"，确认吗？",callback:function(){e.apiDelete(t)}})},btnPreviewClick:function(t){var e=t.form,i=t.template,s="";s=i.isSystem?"/sitefiles/assets/forms/"+i.name+"/index.html?siteId="+this.siteId+"&formId="+e.id+"&apiUrl="+encodeURIComponent("/api"):_.trimEnd(this.siteUrl,"/")+"/forms/"+i.name+"/index.html?siteId="+this.siteId+"&formId="+e.id+"&apiUrl="+encodeURIComponent("/api"),window.open(s)},uploadBefore:t=>!!/(\.zip)$/i.exec(t.name)||(utils.error("上传格式错误，请上传zip压缩包!"),!1),uploadProgress:function(){utils.loading(this,!0)},uploadSuccess:function(t,e){utils.loading(this,!1),utils.success("表单导入成功"),location.reload()},uploadError:function(t){utils.loading(this,!1);var e=JSON.parse(t.message);utils.error(e.message)},btnCloseClick:function(){utils.removeTab()}},$vue=new Vue({el:"#main",data:data,methods:methods,created:function(){utils.keyPress(null,this.btnCloseClick),this.apiGet(),this.urlUpload=$apiUrl+$urlImport+"?siteId="+this.siteId}});