var $url="/cms/contents/contents",data=utils.init({siteId:utils.getQueryInt("siteId"),channelId:utils.getQueryInt("channelId")||utils.getQueryInt("siteId"),root:null,siteUrl:null,groupNames:null,tagNames:null,checkedLevels:[],expendedChannelIds:[],filterText:"",pageContents:null,total:null,pageSize:null,page:1,titleColumn:null,columns:null,permissions:null,contentMenus:null,contentsMenus:null,asideHeight:0,tableMaxHeight:0,multipleSelection:[],checkedColumns:[],breadcrumbItems:[],isChangeBanned:!1,searchForm:{searchType:"Title",searchText:"",isAllContents:!1},isAdvancedForm:!1,advancedForm:{checkedLevels:[],isTop:!1,isRecommend:!1,isHot:!1,isColor:!1,groupNames:[],tagNames:[]}}),methods={apiTree:function(t){var e=this;$api.post($url+"/actions/tree",{siteId:this.siteId,reload:t}).then(function(n){var i=n.data;e.root=[i.root],t?e.expendedChannelIds=[e.siteId,e.channelId]:(utils.loadExternals(i.cssUrls,i.jsUrls),e.siteUrl=i.siteUrl,e.groupNames=i.groupNames,e.tagNames=i.tagNames,e.checkedLevels=i.checkedLevels,e.advancedForm.checkedLevels=_.map(i.checkedLevels,function(t){return t.label}),e.expendedChannelIds=[e.siteId])}).catch(function(t){utils.error(t)}).then(function(){e.asideHeight=$(window).height()-4,e.tableMaxHeight=$(window).height()-128,utils.loading(e,!1)})},apiList:function(t,e,n,i){var l=this;utils.loading(this,!0);var s=_.assign({siteId:this.siteId,channelId:t,page:e,searchType:this.searchForm.searchType,searchText:this.searchForm.searchText,isAdvanced:this.isAdvanced},this.advancedForm);$api.post($url+"/actions/list",s).then(function(s){var a=s.data;l.pageContents=a.pageContents,l.titleColumn=a.titleColumn,l.columns=a.columns,l.total=a.total,l.pageSize=a.pageSize,l.page=e,l.permissions=a.permissions,l.contentMenus=a.contentMenus,l.contentsMenus=a.contentsMenus,l.expendedChannelIds=[l.siteId,t],l.searchForm.isAllContents=a.isAllContents,l.isChangeBanned=a.isChangeBanned,l.breadcrumbItems=a.breadcrumbItems,n&&utils.success(n),i&&l.apiTree(!0)}).catch(function(t){utils.error(t)}).then(function(){utils.loading(l,!1),l.scrollToTop()})},apiColumns:function(t){$api.post($url+"/actions/columns",{siteId:this.siteId,channelId:this.channelId,attributeNames:t}).then(function(t){t.data}).catch(function(t){utils.error(t)})},apiWidth:function(t,e,n,i){$api.post($url+"/actions/width",{siteId:this.siteId,channelId:this.channelId,prevAttributeName:t||"",prevWidth:parseInt(e||0),nextAttributeName:n||"",nextWidth:parseInt(i||0)}).then(function(t){t.data}).catch(function(t){utils.error(t)})},apiOrder:function(t,e,n,i){var l=this;utils.loading(this,!0),$api.post($url+"/actions/order",{siteId:this.siteId,channelId:t,contentId:e,isUp:n,rows:i}).then(function(t){t.data;l.apiList(l.channelId,l.page,"内容排序成功！")}).catch(function(t){utils.error(t)}).then(function(){utils.loading(l,!1)})},handleAllChange:function(){var t=this;utils.loading(this,!0),$api.post($url+"/actions/all",{siteId:this.siteId,channelId:this.channelId,isAllContents:this.searchForm.isAllContents}).then(function(e){e.data;t.apiList(t.channelId,1)}).catch(function(t){utils.error(t)})},getChannelUrl:function(t){return utils.getRootUrl("redirect",{siteId:this.siteId,channelId:t.value})},getContentUrl:function(t){return"NoLink"==t.linkType?"javascript:;":t.referenceId>0&&t.sourceId>0?utils.getRootUrl("redirect",{siteId:t.siteId,channelId:t.sourceId,contentId:t.referenceId}):utils.getRootUrl("redirect",{siteId:t.siteId,channelId:t.channelId,contentId:t.id})},getContentTarget:function(t){return"NoLink"==t.linkType?"":"_blank"},btnTitleClick:function(t){if(t.checked&&t.channelId>0)return!1;utils.openLayer({title:"查看内容",url:utils.getCmsUrl("contentsLayerView",{siteId:this.siteId,channelId:Math.abs(t.channelId),contentId:t.id}),full:!0})},btnSearchClick:function(){this.isAdvancedForm=!1,this.apiList(this.channelId,1)},handleTagNamesChange:function(t){t||(this.isAdvancedForm=!1,this.apiList(this.channelId,1))},btnAddClick:function(){this.isChangeBanned?utils.alertWarning({title:"禁止添加内容",text:"栏目已开启禁止维护内容(添加/修改/删除)功能，添加内容请先在栏目中关闭此功能！"}):utils.addTab("添加内容",this.getAddUrl())},btnImportClick:function(t){"Word"===t?this.btnLayerClick({title:"批量导入Word",name:"Word",full:!0}):"Import"===t?this.btnLayerClick({title:"批量导入",name:"Import",full:!0}):"Add"===t&&this.btnLayerClick({title:"批量添加",name:"Add",full:!0})},btnMoreClick:function(t){"Group"===t?this.btnLayerClick({title:"批量设置分组",name:"Group",width:700,height:400,withContents:!0}):"Tag"===t?this.btnLayerClick({title:"批量设置标签",name:"Tag",width:700,height:400,withContents:!0}):"Copy"===t?this.btnLayerClick({title:"批量复制",name:"Copy",withContents:!0}):"ExportAll"===t?this.btnLayerClick({title:"导出全部",name:"Export",full:!0}):"ExportSelected"===t?this.btnLayerClick({title:"导出选中",name:"Export",full:!0,withContents:!0}):"Arrange"===t?this.btnLayerClick({title:"整理排序",name:"Arrange",width:550,height:350}):"Hits"===t&&this.btnLayerClick({title:"设置点击量",name:"Hits",width:450,height:320,withContents:!0})},btnEditClick:function(t){this.permissions.isEdit&&(this.isChangeBanned?utils.alertWarning({title:"禁止修改内容",text:"栏目已开启禁止维护内容(添加/修改/删除)功能，修改内容请先在栏目中关闭此功能！"}):t.referenceId>0&&t.sourceId>0?utils.openLayer({title:"编辑引用内容",url:utils.getCmsUrl("contentsLayerReference",{siteId:this.siteId,channelId:t.channelId,contentId:t.id,page:this.page}),full:!0}):utils.addTab("编辑内容",this.getEditUrl(t)))},btnAdminClick:function(t){utils.openLayer({title:"管理员查看",url:utils.getCommonUrl("adminLayerView",{adminId:t}),full:!0})},getAddUrl:function(){return utils.getCmsUrl("editor",{siteId:this.siteId,channelId:this.channelId,page:this.page,tabName:utils.getTabName()})},getEditUrl:function(t){return utils.getCmsUrl("editor",{siteId:this.siteId,channelId:t.channelId,contentId:t.id,page:this.page,tabName:utils.getTabName()})},btnCreateClick:function(){var t=this;this.isContentChecked&&(utils.loading(this,!0),$api.post($url+"/actions/create",{siteId:t.siteId,channelContentIds:this.channelContentIdsString}).then(function(e){e.data;utils.addTab("生成进度查看",utils.getCmsUrl("createStatus",{siteId:t.siteId}))}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)}))},btnLayerClick:function(t){if(this.isChangeBanned){if("Delete"===t.name)return utils.alertWarning({title:"禁止删除内容",text:"栏目已开启禁止维护内容(添加/修改/删除)功能，删除内容请先在栏目中关闭此功能！"});if("Word"===t.name||"Import"===t.name||"Add"===t.name)return utils.alertWarning({title:"禁止添加内容",text:"栏目已开启禁止维护内容(添加/修改/删除)功能，添加内容请先在栏目中关闭此功能！"});if("Attributes"===t.name||"Taxis"===t.name||"Check"===t.name||"Group"===t.name||"Tag"===t.name||"Arrange"===t.name||"Hits"===t.name)return utils.alertWarning({title:"禁止修改内容",text:"栏目已开启禁止维护内容(添加/修改/删除)功能，修改内容请先在栏目中关闭此功能！"})}var e={siteId:this.siteId,page:this.page};if(t.channelId?e.channelId=t.channelId:e.channelId=this.channelId,t.contentId&&(e.contentId=t.contentId),t.withContents){if(!this.isContentChecked)return;e.channelContentIds=this.channelContentIdsString}t.url=utils.getCmsUrl("contentsLayer"+t.name,e),utils.openLayer(t)},btnContentStateClick:function(t){this.permissions.isEdit&&utils.openLayer({title:"查看审核状态",url:utils.getCmsUrl("contentsLayerState",{siteId:t.siteId,channelId:t.channelId,contentId:t.id}),full:!0})},btnCommandsClick:function(t){if(t&&-1!==t.indexOf(",")){var e=t.split(",")[0],n=t.split(",")[1];for(var i of this.contentsMenus)if(e===i.id){for(var l of i.children)if(n===l.id){this.btnCommandClick(l);break}break}}},btnCommandClick:function(menu){var args={siteId:this.siteId,channelId:this.channelId,isContentChecked:this.isContentChecked,channelContentIds:this.channelContentIdsString};if(menu.click)eval(menu.click+"(args)");else{var url=utils.addQuery(menu.link,args);"_layer"==menu.target?utils.openLayer({title:menu.text,url:url,full:!0}):"_self"==menu.target?location.href=url:"_parent"==menu.target?parent.location.href=url:"_top"==menu.target?top.location.href=url:"_blank"==menu.target?window.open(url):utils.addTab(menu.text,url)}},btnMenuClick:function(menu,content){if(menu.click)eval(menu.click+"(content)");else{var url=utils.addQuery(menu.link,{siteId:this.siteId,channelId:content.channelId,contentId:content.id});"_layer"==menu.target?utils.openLayer({title:menu.text,url:url,full:!0}):"_self"==menu.target?location.href=url:"_parent"==menu.target?parent.location.href=url:"_top"==menu.target?top.location.href=url:"_blank"==menu.target?window.open(url):utils.addTab(menu.text,url)}},scrollToTop:function(){document.documentElement.scrollTop=document.body.scrollTop=0},tableRowClassName:function(t){return-1!==this.multipleSelection.indexOf(t.row)?"current-row":""},btnChannelClick:function(t){t.disabled||(this.channelId=t.value,this.apiList(t.value,1))},filterNode:function(t,e){return!t||(-1!==e.label.indexOf(t)||e.value+""===t)},handleHeaderDragend:function(t,e,n){for(var i=null,l=null,s=0;s<this.$refs.multipleTable.columns.length;s++){var a=this.$refs.multipleTable.columns[s];a.columnKey&&a.resizable&&(i?l=a:a.columnKey==n.columnKey&&(i=a))}var r=e-t;l&&(l.width+=r),this.apiWidth(i?i.columnKey:"",i?i.width:0,l?l.columnKey:"",l?l.width:0)},handleSelectionChange:function(t){this.multipleSelection=t},toggleSelection:function(t){this.$refs.multipleTable.toggleRowSelection(t)},handleCurrentChange:function(t){this.apiList(this.channelId,t)},handleColumnsChange:function(){for(var t=this.$refs.multipleTable.$el.getElementsByClassName("cell"),e=0;e<t.length;e++){t[e].style.removeProperty("width")}var n=_.filter(this.columns,function(t){return t.isList}),i=_.map(n,function(t){return t.attributeName});this.apiColumns(i)},onSort:function(t){var e=this.pageContents[t.oldIndex],n=t.oldIndex>t.newIndex,i=Math.abs(t.oldIndex-t.newIndex);this.apiOrder(e.channelId,e.id,n,i)},btnCloseClick:function(){utils.removeTab()}},$vue=new Vue({el:"#main",components:{ElTableDraggable:ElTableDraggable},data:data,methods:methods,computed:{isAdvanced:function(){return this.checkedLevels.length!==this.advancedForm.checkedLevels.length||(!!(this.advancedForm.isTop||this.advancedForm.isRecommend||this.advancedForm.isHot||this.advancedForm.isColor)||(this.advancedForm.groupNames.length>0||this.advancedForm.tagNames.length>0))},isContentChecked:function(){return this.multipleSelection.length>0},channelContentIds:function(){for(var t=[],e=0;e<this.multipleSelection.length;e++){var n=this.multipleSelection[e];t.push({channelId:n.channelId,id:n.id})}return t},channelContentIdsString:function(){for(var t=[],e=0;e<this.multipleSelection.length;e++){var n=this.multipleSelection[e];t.push(n.channelId+"_"+n.id)}return t.join(",")}},watch:{filterText:function(t){this.$refs.tree.filter(t)}},created:function(){utils.keyPress(null,this.btnCloseClick),this.apiTree(!1)}});