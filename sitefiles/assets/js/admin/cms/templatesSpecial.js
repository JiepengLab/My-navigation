var $url="/cms/templates/templatesSpecial",$urlUpload=$apiUrl+$url+"/actions/upload",$urlDelete=$url+"/actions/delete",$urlDownload=$url+"/actions/download",$urlCreate=$url+"/actions/create",data=utils.init({siteId:utils.getQueryInt("siteId"),specials:null,siteUrl:null,uploadUrl:null,panel:!1,form:null,uploadList:[]}),methods={apiGet:function(){var t=this;utils.loading(this,!0),$api.get($url,{params:{siteId:this.siteId}}).then(function(i){var l=i.data;t.specials=l.specials,t.siteUrl=l.siteUrl}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},apiGetSpecial:function(t){var i=this;utils.loading(this,!0),$api.get($url+"/"+this.siteId+"/"+t).then(function(l){var e=l.data;i.panel=!0,i.uploadUrl=$urlUpload+"?siteId="+i.siteId+"&guid="+e.guid,i.form=0===t?{siteId:i.siteId,id:0,guid:e.guid,title:"",url:"/special/"+i.formatDate()+"/",fileNames:[],isEditOnly:!1,isUploadOnly:!1}:{siteId:i.siteId,id:t,guid:e.guid,title:e.special.title,url:e.special.url,fileNames:[],isEditOnly:!1,isUploadOnly:!0},i.uploadList=[]}).catch(function(t){utils.error(t)}).then(function(){utils.loading(i,!1)})},apiDelete:function(t){var i=this;utils.loading(this,!0),$api.post($urlDelete,{siteId:this.siteId,specialId:t}).then(function(t){var l=t.data;i.specials=l.specials}).catch(function(t){utils.error(t)}).then(function(){utils.loading(i,!1)})},apiSubmit:function(){var t=this;utils.loading(this,!0),$api.post($url,this.form).then(function(i){var l=i.data;utils.success(0===t.form.id?"专题添加成功！":"专题修改成功！"),t.form=null,t.specials=l.specials}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},btnCreateClick:function(t){var i=this;utils.loading(this,!0),$api.post($urlCreate,{siteId:this.siteId,specialId:t.id}).then(function(t){t.data;utils.addTab("生成进度查看",utils.getCmsUrl("createStatus",{siteId:i.siteId}))}).catch(function(t){utils.error(t)}).then(function(){utils.loading(i,!1)})},btnEditClick:function(t){this.form={siteId:this.siteId,id:t.id,guid:"",title:t.title,url:t.url,fileNames:[],isEditOnly:!0,isUploadOnly:!1},this.panel=!0},btnUploadClick:function(t){this.apiGetSpecial(t.id)},btnDownloadClick:function(t){var i=this;utils.loading(this,!0),$api.post($urlDownload,{siteId:this.siteId,specialId:t.id}).then(function(t){var i=t.data;window.location.href=i.value}).catch(function(t){utils.error(t)}).then(function(){utils.loading(i,!1)})},btnAddClick:function(){this.apiGetSpecial(0)},btnDeleteClick:function(t){var i=this;utils.alertDelete({title:"删除专题",text:"此操作将删除专题 "+t.title+"，确定吗？",callback:function(){i.apiDelete(t.id)}})},btnSubmitClick:function(){if(!this.form.isEditOnly&&0===this.form.fileNames.length)return utils.error("请上传专题文件");var t=this;this.$refs.form.validate(function(i){i&&t.apiSubmit()})},formatDate:function(){var t=new Date,i=""+(t.getMonth()+1),l=""+t.getDate(),e=t.getFullYear();return i.length<2&&(i="0"+i),l.length<2&&(l="0"+l),[e,i,l].join("-")},btnCancelClick:function(){this.panel=!1},uploadBefore:t=>!0,uploadProgress:function(){utils.loading(this,!0)},uploadSuccess:function(t,i){utils.loading(this,!1),this.form.fileNames.push(t.value)},uploadError:function(t){utils.loading(this,!1);var i=JSON.parse(t.message);utils.error(i.message)},uploadRemove:function(t,i){this.form.fileNames.splice(this.form.fileNames.indexOf(t.name),1)},btnCloseClick:function(){utils.removeTab()}},$vue=new Vue({el:"#main",data:data,methods:methods,created:function(){var t=this;utils.keyPress(function(){t.panel&&t.btnSubmitClick()},function(){t.panel?t.btnCancelClick():t.btnCloseClick()}),this.apiGet()}});