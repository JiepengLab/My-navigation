var $url="/settings/sitesTemplates",$urlDelete=$url+"/actions/delete",$urlUpload=$apiUrl+"/settings/sitesTemplates/actions/upload",data=utils.init({pageType:null,siteTemplates:null,fileNameList:null,siteTemplateUrl:null,siteAddPermission:!1,uploadPanel:!1,uploadLoading:!1,uploadList:[]}),error=null,methods={apiGet:function(){var t=this;$api.get($url).then(function(e){var i=e.data;t.siteTemplates=i.siteTemplates,t.fileNameList=i.fileNameList,t.siteTemplateUrl=i.siteTemplateUrl,t.siteAddPermission=i.siteAddPermission}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},btnCreateClick:function(t){location.href=utils.getSettingsUrl("sitesAdd",{type:"submit",createType:"local",localDirectoryName:t.directoryName})},btnEditClick:function(t){location.href=utils.getSettingsUrl("administratorsRoleAdd",{roleId:t.id})},btnDownloadClick:function(t){window.open("/"+this.siteTemplateUrl+"/"+t.directoryName+".zip")},btnZipClick:function(t){var e=this;utils.loading(this,!0),$api.post($url+"/actions/zip",{directoryName:t.directoryName}).then(function(e){e.data;utils.success("站点模板压缩成功！"),t.fileExists=!0}).catch(function(t){utils.error(t)}).then(function(){utils.loading(e,!1)})},btnDeleteClick:function(t){var e=this;utils.alertDelete({title:"删除站点模板",text:"此操作将会删除此站点模板“"+t.siteTemplateName+"”，确认吗？",callback:function(){e.apiDelete(t)}})},apiDelete:function(t){var e=this;utils.loading(this,!0),$api.post($urlDelete,{directoryName:t.directoryName}).then(function(t){t.data;utils.success("站点模板删除成功！"),e.apiGet()}).catch(function(t){utils.error(t)}).then(function(){utils.loading(e,!1)})},btnUnZipClick:function(t){var e=this;utils.loading(this,!0),$api.post($url+"/actions/unZip",{fileName:t}).then(function(t){var i=t.data;e.$notify.success({title:"成功",message:"站点模板解压成功！"}),e.siteTemplates=i.siteTemplates,e.fileNameList=i.fileNameList}).catch(function(t){utils.error(t)}).then(function(){utils.loading(e,!1)})},btnDownloadFileClick:function(t){window.open("/"+this.siteTemplateUrl+"/"+t)},btnDeleteFileClick:function(t){var e=this;utils.alertDelete({title:"删除站点模板压缩包",text:"此操作将会删除此站点模板压缩包“"+t+"”，确认吗？",callback:function(){e.apiDeleteFile(t)}})},apiDeleteFile:function(t){var e=this;utils.loading(this,!0),$api.post($urlDelete,{fileName:t}).then(function(i){i.data;utils.success("站点模板压缩包删除成功！"),e.fileNameList.splice(e.fileNameList.indexOf(t),1)}).catch(function(t){utils.error(t)}).then(function(){utils.loading(e,!1)})},btnUploadClick:function(){this.uploadPanel=!0},uploadBefore(t){var e=-1!==t.name.indexOf(".zip",t.name.length-".zip".length);return e||utils.error("上传站点模板只能是 Zip 格式!"),e},uploadProgress:function(){utils.loading(this,!0)},uploadSuccess:function(t,e){utils.loading(this,!1),this.siteTemplates=t.siteTemplates,this.fileNameList=t.fileNameList,this.siteTemplateUrl=t.siteTemplateUrl,this.uploadPanel=!1,utils.success("站点模板上传成功！")},uploadError:function(t){utils.loading(this,!1);var e=JSON.parse(t.message);utils.error(e.message)},btnCloseClick:function(){utils.removeTab()}},$vue=new Vue({el:"#main",data:data,methods:methods,created:function(){var t=this;utils.keyPress(null,function(){t.uploadPanel?t.uploadPanel=!1:t.btnCloseClick()}),this.apiGet()}});