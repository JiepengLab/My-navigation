var $url="/settings/usersStyle",$urlDelete=$url+"/actions/delete",data=utils.init({returnUrl:decodeURIComponent(utils.getQueryString("returnUrl")),urlUpload:null,styles:null,tableName:null,relatedIdentities:null,uploadPanel:!1,uploadLoading:!1,uploadList:[]}),methods={runTableStyleLayerAddMultiple:function(){this.apiGet()},runTableStyleLayerEditor:function(){this.apiGet()},runTableStyleLayerValidate:function(){this.apiGet()},apiGet:function(){var t=this;utils.loading(this,!0),$api.get($url).then(function(e){var i=e.data;t.styles=i.styles,t.tableName=i.tableName,t.relatedIdentities=i.relatedIdentities,t.urlUpload=$apiUrl+$url+"/actions/import"}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},apiDelete:function(t){var e=this;utils.loading(this,!0),$api.post($urlDelete,{attributeName:t}).then(function(t){var i=t.data;e.styles=i.styles}).catch(function(t){utils.error(t)}).then(function(){utils.loading(e,!1)})},apiReset:function(){var t=this;utils.loading(this,!0),$api.post($url+"/actions/reset").then(function(e){var i=e.data;t.styles=i.value}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},getRules:function(t){return t&&0!==t.length?_.map(t,function(t){return t.message}).join(","):"无验证"},btnEditClick:function(t){utils.openLayer({title:"编辑字段",url:utils.getCommonUrl("tableStyleLayerEditor",{siteId:0,tableName:this.tableName,relatedIdentities:this.relatedIdentities,attributeName:t,excludes:"TextEditor,SelectCascading,Customize"})})},btnValidateClick:function(t){utils.openLayer({title:"设置验证规则",url:utils.getCommonUrl("tableStyleLayerValidate",{tableName:this.tableName,relatedIdentities:this.relatedIdentities,attributeName:t})})},btnDeleteClick:function(t){var e=this;utils.alertDelete({title:"删除字段",text:"此操作将删除字段 "+t+"，确定吗？",callback:function(){e.apiDelete(t)}})},btnAddClick:function(){utils.openLayer({title:"新增字段",url:utils.getCommonUrl("tableStyleLayerEditor",{siteId:0,tableName:this.tableName,relatedIdentities:this.relatedIdentities,excludes:"TextEditor,SelectCascading,Customize"})})},btnAddMultipleClick:function(){utils.openLayer({title:"批量新增字段",url:utils.getCommonUrl("tableStyleLayerAddMultiple",{tableName:this.tableName,relatedIdentities:this.relatedIdentities,excludes:"TextEditor,SelectCascading,Customize"})})},btnImportClick:function(){this.uploadPanel=!0},btnResetClick:function(){var t=this;utils.alertDelete({title:"重置字段",text:"此操作将清空自定义字段并将用户字段恢复为系统默认值，确定吗？",callback:function(){t.apiReset()}})},uploadBefore(t){var e=-1!==t.name.indexOf(".zip",t.name.length-".zip".length);return e||utils.error("样式导入文件只能是 Zip 格式!"),e},uploadProgress:function(){utils.loading(this,!0)},uploadSuccess:function(t,e){this.uploadList=[],this.uploadPanel=!1,utils.success("字段导入成功！"),this.apiGet()},uploadError:function(t){this.uploadList=[],utils.loading(this,!1);var e=JSON.parse(t.message);utils.error(e.message)},btnExportClick:function(){window.open($apiUrl+$url+"/actions/export?access_token="+$token)},btnCloseClick:function(){utils.removeTab()}},$vue=new Vue({el:"#main",data:data,methods:methods,created:function(){var t=this;utils.keyPress(null,function(){t.uploadPanel?t.uploadPanel=!1:t.btnCloseClick()}),this.apiGet()}});