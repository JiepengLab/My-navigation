var $url="/settings/usersLayerProfile",data=utils.init({userId:utils.getQueryInt("userId"),uploadUrl:null,uploadFileList:[],form:null,groups:null,styles:null,settings:null}),methods={runFormLayerImageUploadText:function(t,e,i){this.insertText(t,e,i)},runMaterialLayerImageSelect:function(t,e,i){this.insertText(t,e,i)},insertText:function(t,e,i){(this.form[utils.getCountName(t)]||0)<=e&&(this.form[utils.getCountName(t)]=e),this.form[utils.getExtendName(t,e)]=i,this.form=_.assign({},this.form)},apiGet:function(){var t=this;$api.get($url,{params:{userId:this.userId}}).then(function(e){var i=e.data;if(t.form=_.assign({},i.user),t.groups=i.groups,t.styles=i.styles,t.settings=i.settings,0===this.userId)for(var s=0;s<i.styles.length;s++){var a=i.styles[s];t.form[utils.toCamelCase(a.attributeName)]=a.defaultValue}t.form.avatarUrl&&t.uploadFileList.push({name:"avatar",url:t.form.avatarUrl})}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},apiSubmit:function(){var t=this;utils.loading(this,!0),$api.post($url,this.form).then(function(e){utils.success(t.form.id>0?"用户编辑成功！":"用户添加成功！"),utils.closeLayer(!0)}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},validatePass:function(t,e,i){""===e?i(new Error("请再次输入密码")):e!==this.form.password?i(new Error("两次输入密码不一致!")):i()},btnImageSelectClick:function(t){var e=t.attributeName,i=t.no,s=t.type;"materialImages"===s?this.btnLayerClick({title:"选择素材库图片",name:"materialLayerImageSelect",attributeName:e,no:i,full:!0}):"cloudImages"===s&&utils.openLayer({title:"选择免版权图库",url:utils.getCloudsUrl("layerImagesSelect",{attributeName:t.attributeName,no:t.no})})},btnSubmitClick:function(){var t=this;this.$refs.form.validate(function(e){e&&t.apiSubmit()})},uploadBefore:t=>/(\.jpg|\.jpeg|\.bmp|\.gif|\.png|\.webp)$/i.exec(t.name)?!!(t.size/1024/1024<10)||(utils.error("头像图片大小不能超过 10MB!"),!1):(utils.error("头像只能是图片格式，请选择有效的文件上传!"),!1),uploadProgress:function(){utils.loading(this,!0)},uploadSuccess:function(t,e,i){this.form.avatarUrl=t.value,utils.loading(this,!1),i.length>1&&i.splice(0,1)},uploadError:function(t){utils.loading(this,!1);var e=JSON.parse(t.message);utils.error(e.message)},uploadRemove(t){this.form.avatarUrl=null},btnCancelClick:function(){utils.closeLayer()},btnLayerClick:function(t){var e={userId:this.userId};t.attributeName&&(e.attributeName=t.attributeName),t.no&&(e.no=t.no);var i={title:t.title,url:utils.getCommonUrl(t.name,e)};t.full||(i.width=t.width?t.width:700,i.height=t.height?t.height:500),utils.openLayer(i)},btnExtendAddClick:function(t){var e=this.form[utils.getCountName(t.attributeName)]+1;this.form[utils.getCountName(t.attributeName)]=e,this.form[utils.getExtendName(t.attributeName,e)]="",this.form=_.assign({},this.form)},btnExtendRemoveClick:function(t){var e=this.form[utils.getCountName(t.attributeName)];this.form[utils.getCountName(t.attributeName)]=e-1,this.form[utils.getExtendName(t.attributeName,e)]="",this.form=_.assign({},this.form)},btnExtendPreviewClick:function(t,e){for(var i=this.form[utils.getCountName(t)],s=[],a=0;a<=i;a++){var r=this.form[utils.getExtendName(t,a)];r=utils.getUrl(this.siteUrl,r),s.push({src:r})}layer.photos({photos:{start:e,data:s},anim:5})}},$vue=new Vue({el:"#main",data:data,methods:methods,created:function(){utils.keyPress(this.btnSubmitClick,this.btnCancelClick),this.uploadUrl=$apiUrl+$url+"/actions/upload?userId="+this.userId,this.apiGet()}});