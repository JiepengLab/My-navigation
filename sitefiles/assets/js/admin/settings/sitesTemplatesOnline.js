var $url="/settings/sitesTemplatesOnline",data=utils.init({siteAddPermission:!1,page:utils.getQueryInt("page",1),word:utils.getQueryString("word"),tag:utils.getQueryString("tag"),price:utils.getQueryString("price"),order:utils.getQueryString("order"),buy:utils.getQueryString("buy"),themes:null,count:null,pages:null,tags:[],orderedGuids:[]}),methods={apiGet:function(){var e=this;$api.get($url).then(function(t){var i=t.data;e.siteAddPermission=i.siteAddPermission,e.cloudApiGet()}).catch(function(t){utils.error(t),utils.loading(e,!1)})},cloudApiGet:function(){var e=this;utils.loading(this,!0),cloud.getThemes(this.page,this.word,this.tag,this.price,this.order).then(function(t){var i=t.data;if(e.themes=i.themes,e.count=i.count,e.pages=i.pages,e.tags=i.tags,e.orderedGuids=i.orderedGuids,e.buy){var r=e.buy.split(".")[0],n=e.buy.split(".")[1];e.btnBuyClick(r,n)}}).catch(function(e){utils.error(e,{ignoreAuth:!0})}).then(function(){utils.loading(e,!1)})},getTemplatesUrl:function(){return cloud.host+"/templates/"},getDisplayUrl:function(e){return cloud.getThemesUrl("template.html?userName="+e.userName+"&name="+e.name)},getCoverUrl:function(e){return cloud.hostStorage+"/themes/"+e.userName+"/"+e.name+"/"+_.trim(e.coverUrl,"/")},isCreatable:function(e){return 0===e.price||-1!==this.orderedGuids.indexOf(e.guid)},btnImageClick:function(e){window.open(this.getDisplayUrl(e))},btnPreviewClick:function(e){window.open(cloud.hostDemo+"/"+e.userName+"/"+e.name+"/")},btnCreateClick:function(e){location.href=utils.getSettingsUrl("sitesAdd",{type:"submit",createType:"cloud",cloudThemeUserName:e.userName,cloudThemeName:e.name,isCloudThemeFree:0===e.price})},getPageUrl:function(e){return e<1||e>this.pages||e==this.page?"javascript:;":this.getUrl(e,this.word,this.tag,this.price,this.order)},getTagUrl:function(e){return this.getUrl(this.page,this.word,e,this.price,this.order)},getPriceUrl:function(e){return this.getUrl(this.page,this.word,this.tag,e,this.order)},getOrderUrl:function(e){return this.getUrl(this.page,this.word,this.tag,this.price,e)},btnRedirectClick:function(e){location.href=e},handlePageChange:function(e){location.href=this.getPageUrl(e)},getUrl:function(e,t,i,r,n){var s="?type=selectCloud&page="+e;return t&&(s+="&word="+t),i&&(s+="&tag="+i),r&&(s+="&price="+r),n&&(s+="&order="+n),s},priceChanged:function(){this.cloudApiGet()},orderChanged:function(){this.cloudApiGet()},getThemeUrl:function(e){return e?cloud.host+"/templates/template.html?userName="+encodeURIComponent(e.userName)+"&name="+encodeURIComponent(e.name):"javascript:;"},btnBuyClick:function(e,t){var i=this,r=utils.addQuery(location.href,{buy:e+"."+t});cloud.checkAuth(function(){utils.openLayer({title:"购买",width:600,height:500,url:cloud.host+"/layer/pay.html?resourceType=Theme&userName="+e+"&name="+t}),window.addEventListener("message",function(e){if(e.origin===cloud.host){var t=e.data.userName,r=e.data.name;t&&r&&i.btnCreateClick(e.data)}},!1)},r)},btnCloseClick:function(){utils.removeTab()}},$vue=new Vue({el:"#main",data:data,methods:methods,created:function(){utils.keyPress(null,this.btnCloseClick),this.apiGet()}});