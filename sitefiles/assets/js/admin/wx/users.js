var $url="/wx/users",$urlAddTag="/wx/users/actions/addTag",$urlEditTag="/wx/users/actions/editTag",$urlDeleteTag="/wx/users/actions/deleteTag",$urlBlock="/wx/users/actions/block",$urlUnBlock="/wx/users/actions/unBlock",$urlRemark="/wx/users/actions/remark",data=utils.init({success:!1,errorMessage:null,tags:null,total:null,count:null,users:null,multipleSelection:[],popAddTags:!1,formAddTags:{tagName:null},popEditTags:!1,formEditTags:{tagName:null},dialogRemark:!1,formRemark:{siteId:utils.getQueryInt("siteId"),openId:null,remark:null},form:{siteId:utils.getQueryInt("siteId"),init:!0,isBlock:!1,tagId:0,keyword:null,page:1,perPage:20},user:null}),methods={apiGet:function(t){this.form.page=t;var i=this;utils.loading(this,!0),$api.get($url,{params:this.form}).then(function(t){var e=t.data;if(i.form.init=!1,i.success=e.success,i.errorMessage=e.errorMessage,i.tags=e.tags,i.total=e.total,i.count=e.count,i.users=e.users,i.form.tagId>0){var a=e.tags.find(function(t){return t.id===i.form.tagId});i.formEditTags.tagName=a.name}}).catch(function(t){utils.error(t)}).then(function(){utils.loading(i,!1)})},apiAddTag:function(t){var i=this;utils.loading(this,!0),$api.post($urlAddTag,{siteId:this.form.siteId,tagName:t}).then(function(t){var e=t.data;i.popAddTags=!1,i.formAddTags.tagName=null,i.tags=e.tags,utils.success("标签添加成功！")}).catch(function(t){utils.error(t)}).then(function(){utils.loading(i,!1)})},apiEditTag:function(t){var i=this;utils.loading(this,!0),$api.post($urlEditTag,{siteId:this.form.siteId,tagId:this.form.tagId,tagName:t}).then(function(t){var e=t.data;i.popEditTags=!1,i.formEditTags.tagName=null,i.tags=e.tags,utils.success("标签重命名成功！")}).catch(function(t){utils.error(t)}).then(function(){utils.loading(i,!1)})},apiDeleteTag:function(){var t=this;utils.loading(this,!0),$api.post($urlDeleteTag,{siteId:this.form.siteId,tagId:this.form.tagId}).then(function(i){var e=i.data;t.form.tagId=0,t.tags=e.tags,utils.success("标签删除成功！")}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},apiBlock:function(){var t=this;utils.loading(this,!0),$api.post($urlBlock,{siteId:this.form.siteId,openIds:this.openIds}).then(function(i){i.data;t.apiGet(1),utils.success("成功将用户加入黑名单！")}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},apiUnBlock:function(){var t=this;utils.loading(this,!0),$api.post($urlUnBlock,{siteId:this.form.siteId,openIds:this.openIds}).then(function(i){i.data;t.apiGet(1),utils.success("成功将用户移出黑名单！")}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},apiRemark:function(){var t=this;utils.loading(this,!0),$api.post($urlRemark,this.formRemark).then(function(i){i.data;t.dialogRemark=!1,t.user.remark=t.formRemark.remark,utils.success("备注修改成功！")}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},tableRowClassName:function(t){return-1!==this.multipleSelection.indexOf(t.row)?"current-row":""},handleSelectionChange:function(t){this.multipleSelection=t},toggleSelection:function(t){this.$refs.multipleTable.toggleRowSelection(t)},getUserTitle:function(t){return t.remark?t.remark+"("+t.nickname+")":t.nickname},getUserTags:function(t){if(t.tagIdList&&t.tagIdList.length>0){for(var i=[],e=0;e<t.tagIdList.length;e++){var a=t.tagIdList[e],n=this.tags.find(function(t){return t.id===a});n&&n.name&&i.push(n.name)}return i.join(",")}return""},btnTabClick:function(){this.form.isBlock&&(this.form.tagId=0,this.form.keyword=null),this.apiGet(1)},btnViewClick:function(t){utils.addTab("与 "+t.nickname+" 的聊天记录",utils.getWxUrl("chatSend",{siteId:this.form.siteId,openId:t.openId}))},btnSearchClick(){this.apiGet(1)},btnPageClick:function(t){this.apiGet(t)},btnRemarkClick:function(t){this.user=t,this.dialogRemark=!0,this.formRemark.openId=t.openId,this.formRemark.remark=t.remark},btnAddTagClick:function(){var t=this;this.$refs.formAddTags.validate(function(i){i&&t.apiAddTag(t.formAddTags.tagName)})},btnEditTagClick:function(){var t=this;this.$refs.formEditTags.validate(function(i){i&&t.apiEditTag(t.formEditTags.tagName)})},btnRemarkSubmitClick:function(){var t=this;this.$refs.formRemark.validate(function(i){i&&t.apiRemark()})},btnDeleteTagClick:function(){var t=this;utils.alertDelete({title:"删除标签",text:"确定删除标签 "+this.formEditTags.tagName+" 吗？",callback:function(){t.apiDeleteTag()}})},btnTagClick:function(){},btnBlockClick:function(){var t=this;utils.alertDelete({title:"加入黑名单",text:"确定将选中用户加入黑名单吗？",button:"加入黑名单",callback:function(){t.apiBlock()}})},btnUnBlockClick:function(){var t=this;utils.alertDelete({title:"移出黑名单",text:"确定将选中用户移出黑名单吗？",button:"移出黑名单",callback:function(){t.apiUnBlock()}})},formatSubscribeScene:function(t){return"ADD_SCENE_SEARCH"===t?"公众号搜索":"ADD_SCENE_ACCOUNT_MIGRATION"===t?"公众号迁移":"ADD_SCENE_PROFILE_CARD"===t?"名片分享":"ADD_SCENE_QR_CODE"===t?"扫描二维码":"ADD_SCENEPROFILE_LINK"===t?"图文页内名称点击":"ADD_SCENE_PROFILE_ITEM"===t?"图文页右上角菜单":"ADD_SCENE_PAID"===t?"支付后关注":"其他"}},$vue=new Vue({el:"#main",data:data,methods:methods,computed:{isChecked:function(){return this.multipleSelection.length>0},openIds:function(){for(var t=[],i=0;i<this.multipleSelection.length;i++){var e=this.multipleSelection[i];t.push(e.openId)}return t}},created:function(){this.apiGet(1)}});