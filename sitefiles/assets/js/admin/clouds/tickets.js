var $urlCloud="home/my/tickets",$urlCloudUpload="home/my/tickets/actions/upload",data=utils.init({isTicket:!1,cloudType:"",isAdd:utils.getQueryBoolean("isAdd"),count:0,tickets:[],isMessages:!1,messagesCount:0,messages:[],formInline:{status:"All",ticketNo:"",keyword:"",currentPage:1,offset:0,limit:30},form:{priority:"Normal",category:"Cms",content:"",fileUrls:[]},submitting:!1,uploadToken:"",uploadUrl:"",fileList:[]}),methods={apiGet:function(){var t=this;utils.loading(this,!0),cloud.get($urlCloud,{params:this.formInline}).then(function(i){var e=i.data;t.isTicket=e.isTicket,t.cloudType=e.cloudType,t.count=e.count,t.tickets=e.tickets,t.uploadToken=$cloudToken,t.uploadUrl=cloud.defaults.baseURL+"/"+$urlCloudUpload}).catch(function(t){utils.error(t,{ignoreAuth:!0})}).then(function(){utils.loading(t,!1)})},apiSubmit:function(){var t=this;cloud.post($urlCloud,this.form).then(function(i){i.data.value&&(utils.success("工单提交成功！"),t.isAdd=!1,t.apiGet())}).catch(function(t){utils.error(t,{ignoreAuth:!0})}).then(function(){t.submitting=!1})},getAllTicketPriority:()=>["Normal","High"],getAllTicketStatus:function(){return["All","Waiting","Dealing","Closed"]},getTicketStatus:function(t){return"Waiting"===t?"待您确认":"Dealing"===t?"正在为您处理":"Closed"===t?"工单已关闭":"全部"},getTicketStatusType:function(t){return"Closed"===t.status?"success":"Dealing"===t.status?"info":"danger"},getTicketPriority:function(t){return"High"===t?"加急工单":"普通工单"},getTicketCategory:function(t){return"Cms"===t.category?"CMS问题":"Cloud"===t.category?"网站云问题":"Theme"===t.category?"模板问题":"Extension"===t.category?"插件问题":"其他"},btnSearchClick:function(){this.apiGet()},handleCurrentChange:function(t){this.formInline.currentPage=t,this.formInline.offset=this.formInline.limit*(t-1),this.btnSearchClick()},btnViewClick:function(t){t.isRead=!0,utils.addTab("工单："+t.ticketNo,utils.getCloudsUrl("ticketMessages",{ticketNo:t.ticketNo,tabName:utils.getTabName()}))},isUnread:t=>"Waiting"===t.status&&!t.isRead,getClassName:t=>"Waiting"!==t.status||t.isRead?"":"unread",btnAddClick:function(){this.isTicket&&"Free"!==this.cloudType?this.isAdd=!0:alert({title:"提交工单",text:"系统检测到您的云助手版本为免费版，使用工单请升级云助手版本！",type:"warning",confirmButtonText:"关 闭",showConfirmButton:!0,showCancelButton:!1,buttonsStyling:!1})},handleRemove:function(t){this.fileList.splice(this.fileList.indexOf(t),1)},handlePreview:function(t){window.open(t.url)},uploadBefore:function(t){if(!/(\.jpg|\.png)$/i.exec(t.name))return utils.error("截图只能是图片格式，请选择有效的文件上传!"),!1;var i=t.size/1024/1024<10;return i||utils.error("文件大小不能超过 10MB!"),i},uploadProgress:function(){utils.loading(this,!0)},uploadSuccess:function(t){this.fileList.push(t),utils.loading(this,!1)},uploadError:function(t){utils.loading(this,!1);var i=JSON.parse(t.message);utils.error(i.message)},btnSubmitClick:function(){var t=this;this.$refs.form.validate(function(i){if(i){for(var e of(t.submitting=!0,t.form.fileUrls=[],t.fileList))t.form.fileUrls.push(e.url);t.apiSubmit()}})},btnCancelClick:function(){this.isAdd=!1}},$vue=new Vue({el:"#main",data:data,methods:methods,created:function(){var t=this;cloud.checkAuth(function(){t.apiGet()}),utils.keyPress(function(){t.isTicket&&t.isAdd&&t.btnSubmitClick()})}});