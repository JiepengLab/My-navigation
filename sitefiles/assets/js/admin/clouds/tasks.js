var $url="/clouds/tasks",$urlDelete=$url+"/actions/delete",$urlEnable=$url+"/actions/enable",$urlDashboard="/clouds/dashboard",$urlClouds="cms/clouds",$defaultForm={id:0,title:"",description:"",taskType:"",taskInterval:"",every:1,weeks:[],startDate:new Date((new Date).setTime((new Date).getTime()+36e5)),isNoticeSuccess:!1,isNoticeFailure:!0,noticeFailureCount:1,isNoticeMobile:!1,noticeMobile:"",isNoticeMail:!1,noticeMail:"",isDisabled:!1,timeout:10,createSiteIds:[],createType:"Index",pingHost:""},data=utils.init({isAdd:!1,task:null,active:1,form:_.assign({},$defaultForm),cloudType:null,taskTypes:null,taskIntervals:null,tasks:null,sites:[]}),methods={apiGet:function(t){var i=this;utils.loading(this,!0),$api.get($url).then(function(e){var a=e.data;for(var s of(i.cloudType=a.cloudType,i.taskTypes=a.taskTypes,i.taskIntervals=a.taskIntervals,i.tasks=[],a.tasks))"Create"!=s.taskType&&"Ping"!=s.taskType||i.tasks.push(s);i.sites=a.sites,t&&i.apiCloudGet()}).catch(function(t){utils.error(t)}).then(function(){t||utils.loading(i,!1)})},apiSubmit:function(){var t=this;utils.loading(this,!0),$api.post($url,this.form).then(function(i){i.data;utils.success("定时任务创建成功！"),t.isAdd=!1,t.apiGet(!1)}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},apiDashboardSubmit:function(t,i){$api.post($urlDashboard,{cloudType:t,expirationDate:i}).then(function(t){t.data}).catch(function(t){utils.error(t)})},btnPreviousClick:function(){this.active--},btnNextClick:function(){var t=this;this.$refs.addForm.validate(function(i){i&&(3==t.active?t.apiSubmit():t.active++)})},btnCancelClick:function(){this.isAdd=!1},btnCloseClick:function(){utils.removeTab()},validateEmail:function(t,i,e){if(i){/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(i)?e():e(new Error("通知邮箱格式不正确"))}else e(new Error("请输入通知邮箱"))},validateMobile:function(t,i,e){i?/^1[3-9]\d{9}$/.test(i)?e():e(new Error("手机号码格式不正确")):e(new Error("请输入通知手机号码"))},apiCloudGet:function(){var t=this;utils.loading(this,!0),cloud.get($urlClouds).then(function(i){var e=i.data;t.cloudType!==e.cloudType&&(t.cloudType,e.cloudType,t.apiDashboardSubmit(e.cloudType,e.expirationDate))}).catch(function(t){utils.error(t,{ignoreAuth:!0})}).then(function(){utils.loading(t,!1)})},apiDelete:function(t){var i=this;utils.loading(this,!0),$api.post($urlDelete,{id:t}).then(function(t){t.data;utils.success("定时任务删除成功！"),i.apiGet(!1)}).catch(function(t){utils.error(t)}).then(function(){utils.loading(i,!1)})},apiEnable:function(t){var i=this;utils.loading(this,!0),$api.post($urlEnable,{id:t.id}).then(function(e){e.data;var a=t.isDisabled?"启用":"禁用";utils.success("定时任务"+a+"成功！"),i.apiGet(!1)}).catch(function(t){utils.error(t)}).then(function(){utils.loading(i,!1)})},getTaskType:function(t){for(var i of this.taskTypes)if(i.value==t.taskType)return i.label;return""},getTaskInterval:function(t){for(var i of this.taskIntervals)if(i.value==t)return i.label;return""},btnUpgradeClick:function(){location.href=utils.getCloudsUrl("dashboard",{isUpgrade:!0})},btnDeleteClick:function(t){var i=this;utils.alertDelete({title:"删除定时任务",text:"此操作将删除定时任务 “"+t.title+"”，确定吗？",callback:function(){i.apiDelete(t.id)}})},btnEnableClick:function(t){var i=this,e=t.isDisabled?"启用":"禁用",a=t.isDisabled?"启 用":"禁 用";utils.alertDelete({title:e+"定时任务",text:"此操作将"+e+"定时任务 “"+t.title+"”，确定吗？",button:a,callback:function(){i.apiEnable(t)}})},btnAddClick:function(){this.isAdd=!0,this.task=null,this.active=1,this.form=_.assign({},$defaultForm)},btnEditClick:function(t){this.isAdd=!0,this.task=t,this.active=1,this.form=_.assign({},t),this.form.createSiteIds||(this.form.createSiteIds=[])}},$vue=new Vue({el:"#main",data:data,methods:methods,created:function(){var t=this;utils.keyPress(function(){t.isAdd&&t.btnNextClick()},function(){t.isAdd?t.btnCancelClick():t.btnCloseClick()}),cloud.checkAuth(function(){t.apiGet(!0)})}});