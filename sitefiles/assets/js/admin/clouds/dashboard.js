var $url="/clouds/dashboard",$urlDisconnect=$url+"/actions/disconnect",$urlCloud="cms/dashboard",data=utils.init({isUpgrade:utils.getQueryBoolean("isUpgrade"),isConnect:!1,iFrameUrl:"",cloudType:null,expirationDate:null,expirationDays:-1,upgradeAmount:null,cloudPriceBasic1Month:null,cloudPriceBasic1Year:null,cloudPriceBasic2Year:null,cloudPriceStandard1Month:null,cloudPriceStandard1Year:null,cloudPriceStandard2Year:null,features:null,counts:null,colors:[{color:"#5cb87a",percentage:30},{color:"#1989fa",percentage:50},{color:"#6f7ad3",percentage:65},{color:"#e6a23c",percentage:80},{color:"#f56c6c",percentage:100}],active:0,buyForm:{cloudType:"",periods:"Y1",originalPrice:0,save:0,amount:0,renewalTitle:""}}),methods={apiSubmit:function(){$api.post($url,{cloudType:this.cloudType,expirationDate:this.expirationDate}).then(function(t){t.data}).catch(function(t){utils.error(t)})},apiCloudGet:function(){var t=this;utils.loading(this,!0),cloud.get($urlCloud).then(function(i){var e=i.data;t.cloudType=e.cloudType,t.expirationDate=e.expirationDate;var o=new Date(e.expirationDate).getTime()-(new Date).getTime();t.expirationDays=parseInt(o/864e5),t.upgradeAmount=e.upgradeAmount,t.cloudPriceBasic1Month=e.cloudPriceBasic1Month,t.cloudPriceBasic1Year=e.cloudPriceBasic1Year,t.cloudPriceBasic2Year=e.cloudPriceBasic2Year,t.cloudPriceStandard1Month=e.cloudPriceStandard1Month,t.cloudPriceStandard1Year=e.cloudPriceStandard1Year,t.cloudPriceStandard2Year=e.cloudPriceStandard2Year,t.features=e.features,t.counts=e.counts,t.isUpgrade&&setTimeout(function(){var t=location.href;location.href="#upgrade",history.replaceState(null,null,t)},100),t.apiSubmit()}).catch(function(t){utils.error(t,{ignoreAuth:!0})}).then(function(){utils.loading(t,!1)})},apiDisconnect:function(){var t=this;utils.loading(this,!0),$api.post($urlDisconnect).then(function(t){t.data.value&&(cloud.logout(),utils.alertSuccess({title:"云助手连接已断开!",button:"确 定",callback:function(){location.href=utils.getCloudsUrl("connect",{redirect:location.href})}}))}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},getUserName:function(){return $cloudUserName},getExpirationTip:function(){return this.expirationDays<0?"":this.expirationDays<=10?"danger":this.expirationDays<=20?"warning":"success"},getExpirationDate:function(){return utils.formatDate(this.expirationDate)},getCloudType:function(){return"Basic"==this.cloudType?"基础版":"Standard"==this.cloudType?"标准版":"免费版"},btnBuyClick:function(t){this.active=1,this.buyForm.cloudType=t,this.buyForm.periods="Y1",this.btnChangeClick()},btnRenewalClick:function(){this.active=2,this.buyForm.cloudType=this.cloudType,this.buyForm.periods="Y1","Basic"==this.cloudType?this.buyForm.renewalTitle="基础版（¥"+this.cloudPriceBasic1Month+"/月）":"Standard"==this.cloudType&&(this.buyForm.renewalTitle="标准版（¥"+this.cloudPriceStandard1Month+"/月）"),this.btnChangeClick()},btnUpgradeClick:function(){this.active=3,this.buyForm.cloudType="Standard",this.buyForm.amount=this.upgradeAmount},btnPayClick:function(){var t="CloudBuy",i="云助手购买";2==this.active?(t="CloudRenewal",i="云助手续费"):3==this.active&&(t="CloudUpgrade",i="云助手升级"),utils.openLayer({title:i,width:600,height:500,url:cloud.host+"/layer/pay.html?resourceType="+t+"&type="+this.buyForm.cloudType+"&periods="+this.buyForm.periods}),window.addEventListener("message",function(t){t.origin===cloud.host&&(location.href=utils.getCloudsUrl("dashboard",{r:Math.random()}))},!1)},btnPreviousClick:function(){this.active=0},btnChangeClick:function(){this.buyForm.originalPrice=0;var t=0;"Basic"===this.buyForm.cloudType?t=this.cloudPriceBasic1Month:"Standard"===this.buyForm.cloudType&&(t=this.cloudPriceStandard1Month),"Y1"===this.buyForm.periods?(this.buyForm.originalPrice=12*t,"Basic"===this.buyForm.cloudType?t=this.cloudPriceBasic1Year:"Standard"===this.buyForm.cloudType&&(t=this.cloudPriceStandard1Year),this.buyForm.save=Math.round((this.buyForm.originalPrice-t)/this.buyForm.originalPrice*100)):"Y2"===this.buyForm.periods&&(this.buyForm.originalPrice=24*t,"Basic"===this.buyForm.cloudType?t=this.cloudPriceBasic2Year:"Standard"===this.buyForm.cloudType&&(t=this.cloudPriceStandard2Year),this.buyForm.save=Math.round((this.buyForm.originalPrice-t)/this.buyForm.originalPrice*100)),this.buyForm.amount=t},btnDisconnectClick:function(){var t=this;utils.alertDelete({title:"断开云助手连接",text:"断开连接后云助手相关功能将无法使用，是否确定要断开连接？",button:"断开连接",callback:function(){t.apiDisconnect()}})},btnTicketClick:function(){utils.addTab("工单技术支持",utils.getCloudsUrl("tickets",{isAdd:!0,tabName:utils.getTabName()}))},btnDocsClick:function(){window.open("https://sscms.com/docs/v7/handbook/clouds/")},getOriginalAmount:function(){var t="Basic"==this.buyForm.cloudType?this.cloudPriceBasic1Month:this.cloudPriceStandard1Month;return"Y1"==this.buyForm.periods?t*=12:"Y2"==this.buyForm.periods&&(t*=24),t.toFixed(2)},btnCloseClick:function(){utils.removeTab()}},$vue=new Vue({el:"#main",data:data,methods:methods,created:function(){utils.keyPress(null,this.btnCloseClick);var t=this;cloud.checkAuth(function(){t.apiCloudGet()})}});