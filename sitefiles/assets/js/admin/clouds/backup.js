var $url="/clouds/backup",$urlRestore="/clouds/backup/actions/restore",$urlGetRestoreProgress="/clouds/backup/actions/getRestoreProgress",$urlRestart="/clouds/backup/actions/restart",$urlDashboard="/clouds/dashboard",$urlCloud="cms/backup",$urlCloudRestore="cms/backup/actions/restore",$urlCloudGetRestoreProgress="cms/backup/actions/getRestoreProgress",data=utils.init({activeName:"settings",cloudType:null,isCloudBackup:!1,backups:[],restoreBackup:null,restoreId:null,restoreProgress:0}),methods={apiGet:function(){var t=this;utils.loading(this,!0),$api.get($url).then(function(e){var o=e.data;t.cloudType=o.cloudType,t.isCloudBackup=o.isCloudBackup,t.apiCloudGet()}).catch(function(t){utils.error(t)})},apiSubmit:function(){var t=this;utils.loading(this,!0),$api.post($url,{isCloudBackup:this.isCloudBackup}).then(function(t){t.data;utils.success("云备份设置保存成功！")}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},apiRestore:function(){var t=this;$api.post($urlRestore,{backupId:this.restoreBackup.backupId}).then(function(e){var o=e.data;t.restoreId=o.value,t.apiGetRestoreProgress()}).catch(function(t){utils.error(t)})},apiGetRestoreProgress:function(){var t=this;$api.post($urlGetRestoreProgress,{restoreId:this.restoreId}).then(function(e){var o=e.data;t.restoreProgress=o.value,100==t.restoreProgress?utils.alertSuccess({title:"系统恢复成功",text:"恭喜，系统文件与数据已成功恢复到 “"+t.restoreBackup.createdDate+"” 的备份版本，恢复后需要重启，请点击重启按钮重新启动系统！",button:"重启系统",callback:function(){t.apiRestart()}}):setTimeout(function(){t.apiGetRestoreProgress()},3e3)}).catch(function(t){utils.error(t)})},apiRestart:function(){utils.loading(this,!0),$api.post($urlRestart).then(function(t){setTimeout(function(){utils.alertSuccess({title:"系统重启成功",text:"恭喜，系统重启成功",callback:function(){window.top.location.href=utils.getIndexUrl()}})},3e4)}).catch(function(t){utils.error(t)})},apiDashboardSubmit:function(t,e){$api.post($urlDashboard,{cloudType:t,expirationDate:e}).then(function(t){t.data}).catch(function(t){utils.error(t)})},apiCloudGet:function(){var t=this;cloud.get($urlCloud).then(function(e){var o=e.data;t.cloudType!==o.cloudType&&(t.cloudType,o.cloudType,t.apiDashboardSubmit(o.cloudType,o.expirationDate)),t.backups=o.backups}).catch(function(t){utils.error(t,{ignoreAuth:!0})}).then(function(){utils.loading(t,!1)})},btnSubmitClick:function(){this.apiSubmit()},btnUpgradeClick:function(){location.href=utils.getCloudsUrl("dashboard",{isUpgrade:!0})},btnRestoreClick:function(t){var e=this;utils.alertDelete({title:"系统恢复",text:"此操作将把系统的文件与数据恢复到 “"+t.createdDate+"” 的备份版本，确定吗？",button:"确定恢复",callback:function(){e.activeName="progress",e.restoreBackup=t,e.restoreProgress=0,e.apiRestore()}})},btnCloseClick:function(){utils.removeTab()}},$vue=new Vue({el:"#main",data:data,methods:methods,created:function(){utils.keyPress(this.btnSubmitClick,this.btnCloseClick);var t=this;cloud.checkAuth(function(){t.apiGet()})}});