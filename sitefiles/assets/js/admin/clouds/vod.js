var $url="/clouds/vod",$urlCloud="cms/vod",data=utils.init({activeName:"settings",count:0,videos:[],formInline:{keyword:"",currentPage:1,offset:0,limit:30},isEdit:!1,editForm:{id:0,title:""},isUpload:!1,uploadToken:null,uploadUrl:null,uploadErrorMessage:null,uploadProgressPercent:null,uploadProgressInterval:null,isCloudVod:!1}),methods={apiGet:function(){var t=this;utils.loading(this,!0),$api.get($url).then(function(i){var e=i.data;t.isCloudVod=e.isCloudVod}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},apiSubmit:function(){var t=this;utils.loading(this,!0),$api.post($url,{isCloudVod:this.isCloudVod}).then(function(t){t.data;utils.success("视频点播设置保存成功！")}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},btnSubmitClick:function(){this.apiSubmit()},btnTabsClick:function(){"videos"==this.activeName&&this.apiCloudGet()},apiCloudGet:function(){var t=this;utils.loading(this,!0),cloud.get($urlCloud,{params:this.formInline}).then(function(i){var e=i.data;t.count=e.count,t.videos=e.videos}).catch(function(t){utils.error(t,{ignoreAuth:!0})}).then(function(){utils.loading(t,!1)})},apiCloudDelete:function(t){var i=this;utils.loading(this,!0),cloud.post($urlCloud+"/actions/delete",{id:t}).then(function(t){t.data;utils.success("云视频删除成功！"),i.apiCloudGet()}).catch(function(t){utils.error(t,{ignoreAuth:!0})}).then(function(){utils.loading(i,!1)})},apiCloudEdit:function(){var t=this;utils.loading(this,!0),cloud.post($urlCloud+"/actions/edit",this.editForm).then(function(i){i.data;utils.success("视频编辑成功！"),t.isEdit=!1,t.apiCloudGet()}).catch(function(t){utils.error(t,{ignoreAuth:!0})}).then(function(){utils.loading(t,!1)})},btnSearchClick:function(){this.apiCloudGet()},handleCurrentChange:function(t){this.formInline.currentPage=t,this.formInline.offset=this.formInline.limit*(t-1),this.btnSearchClick()},btnViewClick:function(t){utils.openLayer({title:"预览视频",url:utils.getCommonUrl("editorLayerPreviewVideo",{videoUrl:t.playUrl}),width:600,height:500})},btnDeleteClick:function(t){var i=this;utils.alertDelete({title:"删除云视频",text:"此操作将删除云视频 “"+t.title+"”，确定吗？",callback:function(){i.apiCloudDelete(t.id)}})},btnEditClick:function(t){this.isEdit=!0,this.editForm.id=t.id,this.editForm.title=t.title},btnEditSubmitClick:function(){var t=this;this.$refs.editForm.validate(function(i){i&&t.apiCloudEdit()})},uploadBefore:function(t){this.uploadErrorMessage="";return!!/(\.3gp|\.asf|\.avi|\.dat|\.dv|\.flv|\.f4v|\.gif|\.m2t|\.m4v|\.mj2|\.mjpeg|\.mkv|\.mov|\.mp4|\.mpe|\.mpg|\.mpeg|\.mts|\.ogg|\.qt|\.rm|\.rmvb|\.swf|\.ts|\.vob|\.wmv|\.webm)$/i.exec(t.name)||(this.uploadErrorMessage="请选择有效的文件上传!",!1)},uploadRequest:function(t){var i=this,e=new FormData;e.append("file",t.file);var o={onUploadProgress:function(t){i.uploadProgressPercent=Number((t.loaded/t.total*30).toFixed(2)),t.loaded===t.total&&(i.uploadProgressInterval=setInterval(function(){i.uploadProgressPercent+=1,99===i.uploadProgressPercent&&clearInterval(i.uploadProgressInterval)},1e3))}};cloud.post(this.uploadUrl,e,o).then(function(t){t.data;utils.success("云视频上传成功!"),i.isUpload=!1,i.apiCloudGet()}).catch(function(t){i.uploadProgressPercent=null,i.uploadErrorMessage=utils.getErrorMessage(t)}).then(function(){clearInterval(i.uploadProgressInterval)})},btnUploadClick:function(){this.uploadProgressPercent=null,this.uploadProgressInterval=null,this.isUpload=!0,this.uploadToken=$cloudToken,this.uploadUrl=cloud.defaults.baseURL+"/"+$urlCloud},getSize:function(t){return(t.size/1024/1024).toFixed(2)},getDuration:function(t){return new Date(1e3*parseInt(t.duration)).toISOString().slice(14,19)},btnCloseClick:function(){utils.removeTab()}},$vue=new Vue({el:"#main",data:data,methods:methods,created:function(){utils.keyPress(this.btnSubmitClick,this.btnCloseClick);var t=this;cloud.checkAuth(function(){t.apiGet()})}});