var $url="/profile",$urlUpload="/profile/actions/upload",$urlSendSms="/profile/actions/sendSms",$urlVerifyMobile="/profile/actions/verifyMobile",data=utils.init({uploadUrl:null,uploadFileList:[],isSmsEnabled:!1,isUserVerifyMobile:!1,user:null,form:null,styles:null,settings:null,mobileValidateRules:null,countdown:0}),methods={runFormLayerImageUploadText:function(t,i,e){this.insertText(t,i,e)},runFormLayerImageUploadEditor:function(t,i){this.insertEditor(t,i)},runMaterialLayerImageSelect:function(t,i,e){this.insertText(t,i,e)},runFormLayerFileUpload:function(t,i,e){this.insertText(t,i,e)},runMaterialLayerFileSelect:function(t,i,e){this.insertText(t,i,e)},runFormLayerVideoUpload:function(t,i,e){this.insertText(t,i,e)},runMaterialLayerVideoSelect:function(t,i,e){this.insertText(t,i,e)},runEditorLayerImage:function(t,i){this.insertEditor(t,i)},insertText:function(t,i,e){(this.form[utils.getCountName(t)]||0)<=i&&(this.form[utils.getCountName(t)]=i),this.form[utils.getExtendName(t,i)]=e,this.form=_.assign({},this.form)},apiGet:function(){var t=this;$api.get($url).then(function(i){var e=i.data;t.isSmsEnabled=e.isSmsEnabled,t.isUserVerifyMobile=e.isUserVerifyMobile,t.user=e.entity,t.form=_.assign({},e.entity,{code:""}),t.styles=e.styles,t.settings=e.settings,t.isUserVerifyMobile?t.mobileValidateRules=[{required:!0,message:"请输入手机号码"},{validator:utils.validateMobile,message:"请输入有效的手机号码"}]:t.mobileValidateRules=[{validator:utils.validateMobile,message:"请输入有效的手机号码"}],t.form.avatarUrl&&t.uploadFileList.push({name:"avatar",url:t.form.avatarUrl})}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},apiSendSms:function(){var t=this;utils.loading(this,!0),$api.post($urlSendSms,{mobile:this.form.mobile}).then(function(i){i.data;utils.notifySuccess("验证码发送成功，10分钟内有效"),t.countdown=60;var e=setInterval(function(){t.countdown-=1,t.countdown<=0&&clearInterval(e)},1e3)}).catch(function(t){utils.notifyError(t)}).then(function(){utils.loading(t,!1)})},apiVerifyMobile:function(){var t=this;utils.loading(this,!0),$api.post($urlVerifyMobile,{mobile:this.form.mobile,code:this.form.code}).then(function(i){t.form.mobileVerified=!0,t.apiSubmit()}).catch(function(i){utils.loading(t,!1),utils.notifyError(i)})},apiSubmit:function(){var t=this;delete _.assign({},this.form).code,utils.loading(this,!0),$api.post($url,this.form).then(function(t){utils.success("资料修改成功！")}).catch(function(t){utils.error(t)}).then(function(){utils.loading(t,!1)})},isMobile:function(t){return/^1[3-9]\d{9}$/.test(t)},btnImageSelectClick:function(t){var i=t.attributeName,e=t.no,o=t.type;"materialImages"===o?this.btnLayerClick({title:"选择素材库图片",name:"materialLayerImageSelect",attributeName:i,no:e,full:!0}):"cloudImages"===o&&utils.openLayer({title:"选择免版权图库",url:utils.getCloudsUrl("layerImagesSelect",{attributeName:t.attributeName,no:t.no})})},btnLayerClick:function(t){var i={attributeName:t.attributeName};t.no&&(i.no=t.no);var e={title:t.title,url:utils.getCommonUrl(t.name,i)};t.full||(e.width=t.width?t.width:700,e.height=t.height?t.height:500),utils.openLayer(e)},btnExtendAddClick:function(t){var i=this.form[utils.getCountName(t.attributeName)]+1;this.form[utils.getCountName(t.attributeName)]=i,this.form[utils.getExtendName(t.attributeName,i)]="",this.form=_.assign({},this.form)},btnExtendRemoveClick:function(t){var i=this.form[utils.getCountName(t.attributeName)];this.form[utils.getCountName(t.attributeName)]=i-1,this.form[utils.getExtendName(t.attributeName,i)]="",this.form=_.assign({},this.form)},btnExtendPreviewClick:function(t,i){for(var e=this.form[utils.getCountName(t)],o=[],s=0;s<=e;s++){var r=this.form[utils.getExtendName(t,s)];r=utils.getUrl(this.siteUrl,r),o.push({src:r})}layer.photos({photos:{start:i,data:o},anim:5})},btnSendSmsClick:function(){this.countdown>0||(this.form.mobile?this.isMobile(this.form.mobile)?this.apiSendSms():utils.notifyError("请输入有效的手机号码"):utils.notifyError("手机号码不能为空"))},btnSubmitClick:function(){var t=this;this.$refs.form.validate(function(i){i&&(t.isMobileCode?t.apiVerifyMobile():t.apiSubmit())})},uploadBefore:t=>/(\.jpg|\.jpeg|\.bmp|\.gif|\.png|\.webp)$/i.exec(t.name)?!!(t.size/1024/1024<10)||(utils.error("头像图片大小不能超过 10MB!"),!1):(utils.error("头像只能是图片格式，请选择有效的文件上传!"),!1),uploadProgress:function(){utils.loading(this,!0)},uploadSuccess:function(t,i,e){this.form.avatarUrl=t.value,utils.loading(this,!1),e.length>1&&e.splice(0,1)},uploadError:function(t){utils.loading(this,!1);var i=JSON.parse(t.message);utils.error(i.message)},uploadRemove(t){this.form.avatarUrl=null}},$vue=new Vue({el:"#main",data:data,methods:methods,computed:{isMobileCode:function(){return this.isUserVerifyMobile?!this.user.mobileVerified||this.user.mobile!==this.form.mobile:!!this.isSmsEnabled&&this.user.mobile!==this.form.mobile}},created:function(){this.uploadUrl=$apiUrl+$urlUpload,this.apiGet()}});