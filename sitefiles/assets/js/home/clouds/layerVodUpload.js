var $urlCloud="cms/vod",data=utils.init({attributeName:utils.getQueryString("attributeName"),no:utils.getQueryInt("no"),uploadToken:null,uploadUrl:null,uploadErrorMessage:null,uploadProgressPercent:null,uploadProgressInterval:null}),methods={insert:function(e){parent.$vue.runFormLayerVideoUpload&&parent.$vue.runFormLayerVideoUpload(this.attributeName,this.no,e.playUrl,e.coverUrl)},uploadBefore:function(e){this.uploadErrorMessage="";return!!/(\.3gp|\.asf|\.avi|\.dat|\.dv|\.flv|\.f4v|\.gif|\.m2t|\.m4v|\.mj2|\.mjpeg|\.mkv|\.mov|\.mp4|\.mpe|\.mpg|\.mpeg|\.mts|\.ogg|\.qt|\.rm|\.rmvb|\.swf|\.ts|\.vob|\.wmv|\.webm)$/i.exec(e.name)||(this.uploadErrorMessage="请选择有效的文件上传!",!1)},uploadRequest:function(e){var r=this,t=new FormData;t.append("file",e.file);var l={onUploadProgress:function(e){r.uploadProgressPercent=Number((e.loaded/e.total*30).toFixed(2)),e.loaded===e.total&&(r.uploadProgressInterval=setInterval(function(){r.uploadProgressPercent+=1,99===r.uploadProgressPercent&&clearInterval(r.uploadProgressInterval)},1e3))}};cloud.post(this.uploadUrl,t,l).then(function(e){var t=e.data;r.insert(t),utils.closeLayer()}).catch(function(e){r.uploadProgressPercent=null,r.uploadErrorMessage=utils.getErrorMessage(e)}).then(function(){clearInterval(r.uploadProgressInterval)})},btnCancelClick:function(){utils.closeLayer()}},$vue=new Vue({el:"#main",data:data,methods:methods,created:function(){utils.keyPress(null,this.btnCancelClick),utils.loading(this,!1),this.uploadToken=$cloudToken,this.uploadUrl=cloud.defaults.baseURL+"/"+$urlCloud}});