var $apiUrl=$apiConfig.apiUrl,api=new apiUtils.Api($apiUrl+"/sys/settings/admin/accessTokens"),$vue=new Vue({el:"#main",data:{pageLoad:!1,pageAlert:{type:"warning",html:'API密钥可以用于访问 SiteServer REST API <a href="https://docs.siteserver.cn/api/" target="_blank">阅读更多</a>'},pageType:null,items:null,adminName:null,item:null,adminNames:null,scopes:null},methods:{getItems:function(){var e=this;api.get(null,function(i,t){!i&&t&&t.value&&(e.items=t.value,e.adminName=t.adminName,e.pageLoad=!0)})},getAdminNamesAndScopes:function(){if(!this.adminNames||!this.scopes){var e=this;pageUtils.loading(!0),new apiUtils.Api($apiUrl+"/sys/settings/admin/accessTokens/action/getAdminNamesAndScopes").get(null,function(i,t){pageUtils.loading(!1),!i&&t&&t.value&&(e.adminNames=t.value.adminNames,e.scopes=t.value.scopes)})}},getAccessToken:function(e){var i=this;pageUtils.loading(!0),new apiUtils.Api($apiUrl+"/sys/settings/admin/accessTokens/action/getAccessToken/"+e.id).get(null,function(t,s){pageUtils.loading(!1),!t&&s&&s.value&&(e.accessToken=s.value,i.item=e,i.pageType="view",pageUtils.openLayer({title:"获取密钥",domId:"modal",height:320}))})},delete:function(e){var i=this;pageUtils.loading(!0),api.delete({id:e.id},function(e,t){pageUtils.loading(!1),!e&&t&&t.value&&(i.items=t.value)})},submit:function(e){var i=this;this.item.scopes=this.item.scopeList?this.item.scopeList.join(","):"",pageUtils.loading(!0),api.post(e,function(t,s){if(pageUtils.loading(!1),t)return void(i.pageAlert={type:"danger",html:t.message});i.pageAlert={type:"success",html:e.id?"API密钥修改成功！":"API密钥添加成功！"},i.item=null,i.items=s.value,i.pageType="list"})},regenerate:function(e){var i=this;pageUtils.loading(!0),new apiUtils.Api($apiUrl+"/sys/settings/admin/accessTokens/action/regenerate/"+e.id).post(null,function(e,t){pageUtils.loading(!1),!e&&t&&t.value&&(i.pageType="view",i.item.accessToken=t.value)})},btnAddClick:function(e){this.pageType="add",this.item=e,this.item.adminName=this.item.adminName?this.item.adminName:this.adminName,this.item.scopeList=this.item.scopes?this.item.scopes.split(","):[],this.getAdminNamesAndScopes()},btnSubmitClick:function(){this.submit(this.item)},btnCancelClick:function(){pageUtils.closeLayer(),this.pageType="list",this.item=null},btnViewClick:function(e){this.getAccessToken(e)},btnRegenerateClick:function(e){this.pageType="list",this.regenerate(e)},btnDeleteClick:function(e){var i=this;pageUtils.alertDelete({title:"删除API密钥",text:"此操作将删除API密钥 "+e.title+"，确定吗？",callback:function(){i.delete(e),this.pageType="list"}})}}});$vue.getItems();