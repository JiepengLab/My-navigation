var select={};!function(){function e(e,t){for(;e&&e.parentNode!=t;)e=e.parentNode;return e}function t(t,n){for(;!t.previousSibling&&t.parentNode!=n;)t=t.parentNode;return e(t.previousSibling,n)}function n(e,t){function n(e){for(var t=null;!t&&e;)t=e.nextSibling,e=e.parentNode;return o(t)}function o(e){for(;e&&e.firstChild;)e=e.firstChild;return{node:e,offset:0}}var r=e.document.selection.createRange();r.collapse(t);var l=r.parentElement();if(!isAncestor(e.document.body,l))return null;if(!l.firstChild)return o(l);var c=r.duplicate();c.moveToElementText(l),c.collapse(!0);for(var s=l.firstChild;s;s=s.nextSibling){if(3==s.nodeType){var a=s.nodeValue.length;c.move("character",a)}else c.moveToElementText(s),c.collapse(!1);var i=r.compareEndPoints("StartToStart",c);if(0==i)return n(s);if(1!=i)return 3!=s.nodeType?o(s):(c.setEndPoint("StartToEnd",r),{node:s,offset:a-c.text.length})}return n(l)}function o(e,t){var n=e.document.selection;if(n){var o=n.createRange();o.pasteHTML(t),o.collapse(!1),o.select()}}function r(e,t){var n=t.getSelection();n.removeAllRanges(),n.addRange(e)}function l(e){var t=e.getSelection();return!(!t||0==t.rangeCount)&&t.getRangeAt(0)}function c(e,t){var n=l(e);n&&(n.deleteContents(),n.insertNode(t),webkitLastLineHack(e.document.body),n=e.document.createRange(),n.selectNode(t),n.collapse(!1),r(n,e))}select.ie_selection=document.selection&&document.selection.createRangeCollection;var s=null;select.snapshotChanged=function(){s&&(s.changed=!0)},select.snapshotReplaceNode=function(e,t,n,o){function r(r){e==r.node&&(n&&r.offset>n?r.offset-=n:(r.node=t,r.offset+=o||0))}s&&(s.changed=!0,r(s.start),r(s.end))},select.snapshotMove=function(e,t,n,o,r){function l(l){e!=l.node||r&&0!=l.offset||(l.node=t,l.offset=o?Math.max(0,l.offset+n):n)}s&&(s.changed=!0,l(s.start),l(s.end))},select.ie_selection?(select.markSelection=function(e){if(s=null,e.document.selection){var t=n(e,!0),o=n(e,!1);t&&o&&(s={start:t,end:o,window:e,changed:!1})}},select.selectMarked=function(){function e(e){var t=s.window.document.body.createTextRange(),n=e.node;if(n)if(3==n.nodeType){t.moveToElementText(n.parentNode);for(var o=e.offset;n.previousSibling;)n=n.previousSibling,o+=(n.innerText||"").length;t.move("character",o)}else t.moveToElementText(n),t.collapse(!0);else t.moveToElementText(s.window.document.body),t.collapse(!1);return t}if(s&&s.changed){var t=e(s.start),n=e(s.end);t.setEndPoint("StartToEnd",n),t.select()}},select.selectionTopNode=function(n,o){var r=n.ownerDocument.selection;if(!r)return!1;var l=r.createRange();l.collapse(o);var c=l.parentElement();if(c&&isAncestor(n,c)){var s=l.duplicate();if(s.moveToElementText(c),-1==l.compareEndPoints("StartToStart",s))return e(c,n)}try{l.pasteHTML("<span id='xxx-temp-xxx'></span>")}catch(e){return!1}var a=n.ownerDocument.getElementById("xxx-temp-xxx");if(a){var i=t(a,n);return removeElement(a),i}return!1},select.focusAfterNode=function(e,t){var n=t.ownerDocument.body.createTextRange();n.moveToElementText(e||t),n.collapse(!e),n.select()},select.somethingSelected=function(e){var t=e.document.selection;return t&&""!=t.createRange().text},select.insertNewlineAtCursor=function(e){o(e,"<br>")},select.insertTabAtCursor=function(e){o(e,"    ")},select.cursorPos=function(e,t){var n=e.ownerDocument.selection;if(!n)return null;for(var o=select.selectionTopNode(e,t);o&&"BR"!=o.nodeName;)o=o.previousSibling;var r=n.createRange(),l=r.duplicate();if(r.collapse(t),o)l.moveToElementText(o),l.collapse(!1);else{try{l.moveToElementText(e)}catch(e){return null}l.collapse(!0)}return r.setEndPoint("StartToStart",l),{node:o,offset:r.text.length}},select.setCursorPos=function(e,t,n){function o(t){var n=e.ownerDocument.body.createTextRange();return t.node?(n.moveToElementText(t.node),n.collapse(!1)):(n.moveToElementText(e),n.collapse(!0)),n.move("character",t.offset),n}var r=o(t);n&&n!=t&&r.setEndPoint("EndToEnd",o(n)),r.select()},select.scrollToCursor=function(e){var t=e.ownerDocument.selection;if(!t)return null;t.createRange().scrollIntoView()},select.scrollToNode=function(e){e&&e.scrollIntoView()},select.selectionCoords=function(e){var t=e.document.selection;if(!t)return null;var n=t.createRange(),o=n.duplicate();n.collapse(!0),o.collapse(!1);var r=e.document.body;return{start:{x:n.boundingLeft+r.scrollLeft-1,y:n.boundingTop+r.scrollTop},end:{x:o.boundingLeft+r.scrollLeft-1,y:o.boundingTop+r.scrollTop}}},select.selectCoords=function(e,t){if(t){var n=e.document.body.createTextRange(),o=n.duplicate();try{n.moveToPoint(t.start.x,t.start.y),o.moveToPoint(t.end.x,t.end.y),n.setEndPoint("EndToStart",o),n.select()}catch(e){alert(e.message)}}}):(select.markSelection=function(e){function t(e){for(;3!=e.node.nodeType&&"BR"!=e.node.nodeName;){var t=e.node.childNodes[e.offset]||e.node.nextSibling;for(e.offset=0;!t&&e.node.parentNode;)e.node=e.node.parentNode,t=e.node.nextSibling;if(e.node=t,!t)break}}var n=e.getSelection();if(!n||0==n.rangeCount)return s=null;var o=n.getRangeAt(0);s={start:{node:o.startContainer,offset:o.startOffset},end:{node:o.endContainer,offset:o.endOffset},window:e,changed:!1},t(s.start),t(s.end)},select.selectMarked=function(){function e(e,o){e.node?0==e.offset?n["set"+o+"Before"](e.node):n["set"+o](e.node,e.offset):n.setStartAfter(t.document.body.lastChild||t.document.body)}if(s&&s.changed){var t=s.window,n=t.document.createRange();e(s.end,"End"),e(s.start,"Start"),r(n,t)}},select.selectionTopNode=function(n,o){var r=l(n.ownerDocument.defaultView);if(!r)return!1;var c=o?r.startContainer:r.endContainer,s=o?r.startOffset:r.endOffset;return window.opera&&!o&&r.endContainer==n&&r.endOffset==r.startOffset+1&&n.childNodes[r.startOffset]&&"BR"==n.childNodes[r.startOffset].nodeName&&s--,3==c.nodeType?s>0?e(c,n):t(c,n):"HTML"==c.nodeName?1==s?null:n.lastChild:c==n?0==s?null:c.childNodes[s-1]:s==c.childNodes.length?e(c,n):0==s?t(c,n):e(c.childNodes[s-1],n)},select.focusAfterNode=function(e,t){var n=t.ownerDocument.defaultView,o=n.document.createRange();o.setStartBefore(t.firstChild||t),e&&!e.firstChild?o.setEndAfter(e):e?o.setEnd(e,e.childNodes.length):o.setEndBefore(t.firstChild||t),o.collapse(!1),r(o,n)},select.somethingSelected=function(e){var t=l(e);return t&&!t.collapsed},select.insertNewlineAtCursor=function(e){c(e,e.document.createElement("BR"))},select.insertTabAtCursor=function(e){c(e,e.document.createTextNode("    "))},select.cursorPos=function(e,t){var n=l(window);if(n){for(var o=select.selectionTopNode(e,t);o&&"BR"!=o.nodeName;)o=o.previousSibling;return n=n.cloneRange(),n.collapse(t),o?n.setStartAfter(o):n.setStartBefore(e),{node:o,offset:n.toString().length}}},select.setCursorPos=function(e,t,n){function o(t,n,o){function r(e){3==e.nodeType?l.push(e):forEach(e.childNodes,r)}if(t=t?t.nextSibling:e.firstChild){if(0==n)return c["set"+o+"Before"](t),!0;for(var l=[];;){for(;t&&!l.length;)r(t),t=t.nextSibling;var s=l.shift();if(!s)return!1;var a=s.nodeValue.length;if(a>=n)return c["set"+o](s,n),!0;n-=a}}}var l=e.ownerDocument.defaultView,c=l.document.createRange();n=n||t,o(n.node,n.offset,"End")&&o(t.node,t.offset,"Start")&&r(c,l)},select.scrollToNode=function(e){if(e){for(var t=e.ownerDocument,n=t.body,o=t.defaultView,r=t.documentElement;e&&!e.offsetTop;)e=e.previousSibling;for(var l=0,c=e;c&&c.offsetParent;)l+=c.offsetTop,c=c.offsetParent;var s=l-(n.scrollTop||r.scrollTop||0);(s<0||s>o.innerHeight-30)&&o.scrollTo(n.scrollLeft||r.scrollLeft||0,l)}},select.scrollToCursor=function(e){select.scrollToNode(select.selectionTopNode(e,!0)||e.firstChild)})}();