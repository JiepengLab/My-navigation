var XMLParser=Editor.Parser=function(){function n(n){function t(n){for(var t=n.length-1;t>=0;t--)k.push(n[t])}function e(){t(arguments),A=!0}function a(){t(arguments),A=!1}function i(n){C=n}function l(n){return function(t,r){r==n?e():i("xml-error")||e(arguments.callee)}}function c(n,t){var e=r.doNotIndent.hasOwnProperty(n)||I&&I.noIndent;I={prev:I,name:n,indent:O,startOfLine:t,noIndent:e}}function f(){I=I.prev}function m(n){return function(t,e){var r=n;if(r&&r.noIndent)return e;if(o&&/<!\[CDATA\[/.test(t))return 0;for(r&&/^<\//.test(t)&&(r=r.prev);r&&!r.startOfLine;)r=r.prev;return r?r.indent+indentUnit:0}}function s(){return a(x,s)}function x(n,t){"<"==t?e(d,v,h(1==w)):"</"==t?e(p,l(">")):"xml-cdata"==n?(I&&"!cdata"==I.name||c("!cdata"),/\]\]>$/.test(t)&&f(),e()):M.hasOwnProperty(n)?e():i("xml-error")||e()}function d(n,t){"xml-name"==n?(b=t.toLowerCase(),i("xml-tagname"),e()):(b=null,a())}function p(n,t){"xml-name"==n&&I&&t.toLowerCase()==I.name?(f(),i("xml-tagname")):i("xml-error"),e()}function h(n){return function(t,o){"/>"==o||">"==o&&r.autoSelfClosers.hasOwnProperty(b)?e():">"==o?c(b,n)||e():i("xml-error")||e(arguments.callee)}}function v(n){"xml-name"==n?i("xml-attname")||e(g,v):a()}function g(n,t){"="==t?e(y):">"==t||"/>"==t?a(h):a()}function y(n){"xml-attribute"==n?e(y):a()}var A,C,L=u(n),k=[s],w=0,O=0,b=null,I=null,M={"xml-text":!0,"xml-entity":!0,"xml-comment":!0,"xml-processing":!0};return{indentation:function(){return O},next:function(){var n=L.next();if("whitespace"==n.style&&0==w?O=n.value.length:w++,"\n"==n.content&&(O=w=0,n.indentation=m(I)),"whitespace"==n.style||"xml-comment"==n.type)return n;for(;;)if(A=C=!1,k.pop()(n.style,n.content),A)return C&&(n.style=C),n},copy:function(){var n=k.concat([]),t=L.state,e=I,r=this;return function(o){return k=n.concat([]),w=O=0,I=e,L=u(o,t),r}}}}var t={autoSelfClosers:{br:!0,img:!0,hr:!0,link:!0,input:!0,meta:!0,col:!0,frame:!0,base:!0,area:!0},doNotIndent:{pre:!0,"!cdata":!0}},e={autoSelfClosers:{},doNotIndent:{"!cdata":!0}},r=t,o=!1,u=function(){function n(n,e){var o=n.next();if("<"==o)return n.equals("!")?(n.next(),n.equals("[")?n.lookAhead("[CDATA[",!0)?(e(r("xml-cdata","]]>")),null):"xml-text":n.lookAhead("--",!0)?(e(r("xml-comment","--\x3e")),null):"xml-text"):n.equals("?")?(n.next(),n.nextWhileMatches(/[\w\._\-]/),e(r("xml-processing","?>")),"xml-processing"):(n.equals("/")&&n.next(),e(t),"xml-punctuation");if("&"==o){for(;!n.endOfLine()&&";"!=n.next(););return"xml-entity"}return n.nextWhileMatches(/[^&<\n]/),"xml-text"}function t(t,r){var o=t.next();return">"==o?(r(n),"xml-punctuation"):/[?\/]/.test(o)&&t.equals(">")?(t.next(),r(n),"xml-punctuation"):"="==o?"xml-punctuation":/[\'\"]/.test(o)?(r(e(o)),null):(t.nextWhileMatches(/[^\s\u00a0=<>\"\'\/?]/),"xml-name")}function e(n){return function(e,r){for(;!e.endOfLine();)if(e.next()==n){r(t);break}return"xml-attribute"}}function r(t,e){return function(r,o){for(;!r.endOfLine();){if(r.lookAhead(e,!0)){o(n);break}r.next()}return t}}return function(t,e){return tokenizer(t,e||n)}}();return{make:n,electricChars:"/",configure:function(n){null!=n.useHTMLKludges&&(r=n.useHTMLKludges?t:e),n.alignCDATA&&(o=n.alignCDATA)}}}();