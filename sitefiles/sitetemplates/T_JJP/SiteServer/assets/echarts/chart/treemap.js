define("echarts/chart/treemap",["require","./base","zrender/tool/area","zrender/shape/Rectangle","zrender/shape/Text","zrender/shape/Line","../layout/TreeMap","../data/Tree","../config","../util/ecData","zrender/config","zrender/tool/event","zrender/tool/util","zrender/tool/color","../chart"],function(e){function t(e,t,i,h,o){r.call(this,e,t,i,h,o),this.refresh(h);var n=this;n._onclick=function(e){return n.__onclick(e)},n.zr.on(c.EVENT.CLICK,n._onclick)}var r=e("./base"),i=e("zrender/tool/area"),h=e("zrender/shape/Rectangle"),o=e("zrender/shape/Text"),n=e("zrender/shape/Line"),a=e("../layout/TreeMap"),l=e("../data/Tree"),s=e("../config");s.treemap={zlevel:0,z:1,calculable:!1,clickable:!0,center:["50%","50%"],size:["80%","80%"],root:"",itemStyle:{normal:{label:{show:!0,x:5,y:12,textStyle:{align:"left",color:"#000",fontFamily:"Arial",fontSize:13,fontStyle:"normal",fontWeight:"normal"}},breadcrumb:{show:!0,textStyle:{}},borderWidth:1,borderColor:"#ccc",childBorderWidth:1,childBorderColor:"#ccc"},emphasis:{}}};var d=e("../util/ecData"),c=e("zrender/config"),g=(e("zrender/tool/event"),e("zrender/tool/util")),u=e("zrender/tool/color");return t.prototype={type:s.CHART_TYPE_TREEMAP,refresh:function(e){this.clear(),e&&(this.option=e,this.series=this.option.series),this._treesMap={};for(var t=this.series,r=this.component.legend,i=0;i<t.length;i++)if(t[i].type===s.CHART_TYPE_TREEMAP){t[i]=this.reformOption(t[i]);var h=t[i].name||"";if(this.selectedMap[h]=!r||r.isSelected(h),!this.selectedMap[h])continue;this._buildSeries(t[i],i)}},_buildSeries:function(e,t){var r=l.fromOptionData(e.name,e.data);this._treesMap[t]=r;var i=e.root&&r.getNodeById(e.root)||r.root;this._buildTreemap(i,t)},_buildTreemap:function(e,t){for(var r=this.shapeList,i=0;i<r.length;){var h=r[i];d.get(h,"seriesIndex")===t?(this.zr.delShape(r[i]),r.splice(i,1)):i++}for(var o=r.length,n=this.series[t],l=n.itemStyle,s=this.parsePercent(n.size[0],this.zr.getWidth())||400,c=this.parsePercent(n.size[1],this.zr.getHeight())||500,g=this.parseCenter(this.zr,n.center),u=g[0]-.5*s,p=g[1]-.5*c,f=s*c,y=0,x=[],v=e.children,i=0;i<v.length;i++)y+=v[i].data.value;for(var m=0;m<v.length;m++)x.push(v[m].data.value*f/y);for(var b=new a({x:u,y:p,width:s,height:c}),w=b.run(x),_=0;_<w.length;_++){var z=v[_].data,T=w[_],S=[z.itemStyle,l],B=this.deepMerge(S);B.normal.color||(B.normal.color=this.zr.getColor(_)),B.emphasis.color||(B.emphasis.color=B.normal.color),this._buildItem(z,B,T,t,_),z.children&&this._buildChildrenTreemap(z.children,B,T,t)}this.query(n,"itemStyle.normal.breadcrumb.show")&&this._buildBreadcrumb(e,t,u,p+c);for(var i=o;i<r.length;i++)this.zr.addShape(r[i])},_buildItem:function(e,t,r,i,h){var o=this.series,n=this.getRectangle(e,t,r);d.pack(n,o[i],i,e,h,e.name),this.shapeList.push(n)},getRectangle:function(e,t,r){var i=t.emphasis,o=t.normal,n=this.getLabel(t,r,e.name,e.value),a=this.option.hoverable,l={zlevel:this.getZlevelBase(),z:this.getZBase(),hoverable:a,clickable:!0,style:g.merge({x:r.x,y:r.y,width:r.width,height:r.height,brushType:"both",color:o.color,lineWidth:o.borderWidth,strokeColor:o.borderColor},n.style,!0),highlightStyle:g.merge({color:i.color,lineWidth:i.borderWidth,strokeColor:i.borderColor},n.highlightStyle,!0)};return new h(l)},getLabel:function(e,t,r,h){var o=e.normal.label.textStyle,n=[e.emphasis.label.textStyle,o],a=this.deepMerge(n),l=e.normal.label.formatter,s=this.getLabelText(r,h,l),d=this.getFont(o),c=i.getTextWidth(s,d),g=i.getTextHeight(s,d),u=this.deepQuery([e.emphasis,e.normal],"label.formatter"),p=this.getLabelText(r,h,u),f=this.getFont(a),y=i.getTextWidth(s,f),x=i.getTextHeight(s,f);return e.normal.label.show?(e.normal.label.x+c>t.width||e.normal.label.y+g>t.height)&&(s=""):s="",e.emphasis.label.show?(a.x+y>t.width||a.y+x>t.height)&&(p=""):p="",{style:{textX:t.x+e.normal.label.x,textY:t.y+e.normal.label.y,text:s,textPosition:"specific",textColor:o.color,textFont:d},highlightStyle:{textX:t.x+e.emphasis.label.x,textY:t.y+e.emphasis.label.y,text:p,textColor:a.color,textPosition:"specific"}}},getLabelText:function(e,t,r){return r?"function"==typeof r?r.call(this.myChart,e,t):"string"==typeof r?(r=r.replace("{b}","{b0}").replace("{c}","{c0}"),r=r.replace("{b0}",e).replace("{c0}",t)):void 0:e},_buildChildrenTreemap:function(e,t,r,i){for(var h=r.width*r.height,o=0,n=[],l=0;l<e.length;l++)o+=e[l].value;for(var s=0;s<e.length;s++)n.push(e[s].value*h/o);for(var c=new a({x:r.x,y:r.y,width:r.width,height:r.height}),g=c.run(n),u=t.normal.childBorderWidth,p=t.normal.childBorderColor,f=0;f<g.length;f++){var y=g[f],x=[];r.y.toFixed(2)!==y.y.toFixed(2)&&x.push(this._getLine(y.x,y.y,y.x+y.width,y.y,u,p)),r.x.toFixed(2)!==y.x.toFixed(2)&&x.push(this._getLine(y.x,y.y,y.x,y.y+y.height,u,p)),(r.y+r.height).toFixed(2)!==(y.y+y.height).toFixed(2)&&x.push(this._getLine(y.x,y.y+y.height,y.x+y.width,y.y+y.height,u,p)),(r.x+r.width).toFixed(2)!==(y.x+y.width).toFixed(2)&&x.push(this._getLine(y.x+y.width,y.y,y.x+y.width,y.y+y.height,u,p));for(var v=0;v<x.length;v++)d.set(x[v],"seriesIndex",i),this.shapeList.push(x[v])}},_getLine:function(e,t,r,i,h,o){var a={zlevel:this.getZlevelBase(),z:this.getZBase(),hoverable:!1,style:{xStart:e,yStart:t,xEnd:r,yEnd:i,lineWidth:h,strokeColor:o}};return new n(a)},_buildBreadcrumb:function(e,t,r,i){for(var h=[],n=e;n;)h.unshift(n.data.name),n=n.parent;for(var a=this.series[t],l=this.query(a,"itemStyle.normal.breadcrumb.textStyle")||{},s=this.query(a,"itemStyle.emphasis.breadcrumb.textStyle")||{},c={y:i+10,textBaseline:"top",textAlign:"left",color:l.color,textFont:this.getFont(l)},p={brushType:"fill",color:s.color||u.lift(l.color,-.3),textFont:this.getFont(s)},f=0;f<h.length;f++){var y=new o({zlevel:this.getZlevelBase(),z:this.getZBase(),style:g.merge({x:r,text:h[f]+(h.length-1-f?" > ":"")},c),clickable:!0,highlightStyle:p});d.set(y,"seriesIndex",t),d.set(y,"name",h[f]),r+=y.getRect(y.style).width,this.shapeList.push(y)}},__onclick:function(e){var t=e.target;if(t){var r=d.get(t,"seriesIndex"),i=d.get(t,"name"),h=this._treesMap[r],o=h.getNodeById(i);o&&o.children.length&&this._buildTreemap(o,r)}}},g.inherits(t,r),e("../chart").define("treemap",t),t}),define("echarts/layout/TreeMap",["require"],function(){function e(e){e.x,e.y,e.width,e.height,this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height}return e.prototype.run=function(e){var t=[];return this._squarify(e,{x:this.x,y:this.y,width:this.width,height:this.height},t),t},e.prototype._squarify=function(e,t,r){var i="VERTICAL",h=t.width,o=t.height;t.width<t.height&&(i="HORIZONTAL",h=t.height,o=t.width);for(var n=this._getShapeListInAbstractRow(e,h,o),a=0;a<n.length;a++){n[a].x=0,n[a].y=0;for(var l=0;a>l;l++)n[a].y+=n[l].height}var s={};if("VERTICAL"==i){for(var d=0;d<n.length;d++)r.push({x:n[d].x+t.x,y:n[d].y+t.y,width:n[d].width,height:n[d].height});s={x:n[0].width+t.x,y:t.y,width:t.width-n[0].width,height:t.height}}else{for(var c=0;c<n.length;c++)r.push({x:n[c].y+t.x,y:n[c].x+t.y,width:n[c].height,height:n[c].width});s={x:t.x,y:t.y+n[0].width,width:t.width,height:t.height-n[0].width}}var g=e.slice(n.length);0!==g.length&&this._squarify(g,s,r)},e.prototype._getShapeListInAbstractRow=function(e,t,r){if(1===e.length)return[{width:t,height:r}];for(var i=1;i<e.length;i++){var h=this._placeFixedNumberRectangles(e.slice(0,i),t,r),o=this._placeFixedNumberRectangles(e.slice(0,i+1),t,r);if(this._isFirstBetter(h,o))return h}},e.prototype._placeFixedNumberRectangles=function(e,t,r){for(var i=e.length,h=[],o=0,n=0;n<e.length;n++)o+=e[n];for(var a=o/r,l=0;i>l;l++){var s=r*e[l]/o;h.push({width:a,height:s})}return h},e.prototype._isFirstBetter=function(e,t){var r=e[0].height/e[0].width;r=r>1?1/r:r;var i=t[0].height/t[0].width;return i=i>1?1/i:i,Math.abs(r-1)<=Math.abs(i-1)},e}),define("echarts/data/Tree",["require","zrender/tool/util"],function(e){function t(e,t){this.id=e,this.depth=0,this.height=0,this.children=[],this.parent=null,this.data=t||null}function r(e){this.root=new t(e)}var i=e("zrender/tool/util");return t.prototype.add=function(e){var t=this.children;e.parent!==this&&(t.push(e),e.parent=this)},t.prototype.remove=function(e){var t=this.children,r=i.indexOf(t,e);r>=0&&(t.splice(r,1),e.parent=null)},t.prototype.traverse=function(e,t){e.call(t,this);for(var r=0;r<this.children.length;r++)this.children[r].traverse(e,t)},t.prototype.updateDepthAndHeight=function(e){var t=0;this.depth=e;for(var r=0;r<this.children.length;r++){var i=this.children[r];i.updateDepthAndHeight(e+1),i.height>t&&(t=i.height)}this.height=t+1},t.prototype.getNodeById=function(e){if(this.id===e)return this;for(var t=0;t<this.children.length;t++){var r=this.children[t].getNodeById(e);if(r)return r}},r.prototype.traverse=function(e,t){this.root.traverse(e,t)},r.prototype.getSubTree=function(e){var t=this.getNodeById(e);if(t){var i=new r(t.id);return i.root=t,i}},r.prototype.getNodeById=function(e){return this.root.getNodeById(e)},r.fromOptionData=function(e,i){function h(e,r){var i=new t(e.name,e);r.add(i);var o=e.children;if(o)for(var n=0;n<o.length;n++)h(o[n],i)}var o=new r(e),n=o.root;n.data={name:e,children:i};for(var a=0;a<i.length;a++)h(i[a],n);return o.root.updateDepthAndHeight(0),o},r.fromGraph=function(e){function i(t){for(var r=e.getNodeById(t.id),h=0;h<r.outEdges.length;h++){var n=r.outEdges[h],a=o[n.node2.id];t.children.push(a),i(a)}}for(var h={},o={},n=0;n<e.nodes.length;n++){var a,l=e.nodes[n];0===l.inDegree()?(h[l.id]=new r(l.id),a=h[l.id].root):a=new t(l.id),a.data=l.data,o[l.id]=a}var s=[];for(var d in h)i(h[d].root),h[d].root.updateDepthAndHeight(0),s.push(h[d]);return s},r});